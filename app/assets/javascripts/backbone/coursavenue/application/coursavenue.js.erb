
/* this file simply creates a top level Module in which Lib can live */

CoursAvenue = new Backbone.Marionette.Application({
    slug: 'coursavenue',

    /*
     * Try to login in user by showing the sign in/up popup
     * options:
     *     success: function - callback executed if user correctly signs in / up
     *     dismiss: function - callback executed if user dismiss the modal
     *
     */
    login: function signIn (options) {
        new CoursAvenue.Views.SignUpView(options);
    },

    loginWithFacebook: function loginWithFacebook (options) {
        FB.login(function(response) {
            if (response.status === 'connected') {
                $.ajax({
                    url: Routes.user_omniauth_callback_path({ action: 'facebook' }),
                    type: 'GET',
                    dataType: 'json',
                    error: function error (response) {
                        if (options.error) { options.error(); }
                    },
                    success: function success (response) {
                        if (options.success) { options.success(); }
                    }
                });
                // Logged into your app and Facebook.
            } else if (response.status === 'not_authorized') {
                options.error();
                GLOBAL.flash('Nous ne pouvons vous authentifier')
                // The person is logged into Facebook, but not your app.
            } else {
              // The person is not logged into Facebook, so we're not sure if
              // they are logged into this app or not.
            }
        }, { scope: 'public_profile,email,user_location,user_birthday,user_activities'});
    }
});

$(document).ready(function() {
    CoursAvenue.start({});
});

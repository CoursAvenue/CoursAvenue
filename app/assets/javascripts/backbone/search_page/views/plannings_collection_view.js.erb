SearchPage.module('Views', function(Module, App, Backbone, Marionette, $, _, undefined) {

    Module.PlanningsCollectionView = Marionette.CompositeView.extend({
        childView: Module.PlanningView,
        template: Module.templateDirname() + 'plannings_collection_view',
        // childViewContainer: '[data-type=container]'

        initialize: function initialize() {
            this.client = algoliasearch('<%= ENV['ALGOLIA_APPLICATION_ID'] %>', '<%= ENV['ALGOLIA_SEARCH_API_KEY'] %>');
            this.index  = this.client.initIndex('Planning_' + CoursAvenue.env);

            this.collection.on('reset', function(planning_collection) {
                this.trigger('plannings:reset', planning_collection.models)
            }.bind(this));

            this.index.search('', function searchDone(err, content) {
                this.collection.reset(content.hits);
            }.bind(this));
        },

        /*
         * @param bounds: [[NorthWestLat, NorthWestLng], [SouthEastLat, SouthEastLng]]
         */
        searchWithNewBounds: function searchWithNewBounds (bounds) {
            var data = { insideBoundingBox: bounds.toString() };
            this.index.search('', data, function searchDone(err, content) {
                this.collection.reset(content.hits);
            }.bind(this));
        }
    });
});

= content_for :above_container do
  - if @city_image
    .home-screen.bg-cover{style: "background-image: url(#{@city_image})"}
      %h1.text--center.home-screen-title{style: 'padding-top: 3em;'}
        Tous les cours à #{@city.name}
  - else
    #map.google-map.google-map--medium-small

  .white-box--noshadow
    .main-container.push--ends
      %h2.text--center Les cours à #{@city.name} en quelques chiffres
      %hr
      .grid
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Profils
          .bold= @structures_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Séance
          .bold= @plannings_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Lieux
          .bold= @places_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Cours d'essai gratuit
          .bold= @free_trial_course_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Photos & vidéos
          .bold= @medias_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Avis d'élèves
          .bold= @comments_count

%h3.text--center.soft--top Séléction de disciplines
.main-container
  - # Show facets with more than 10 results
  - @structure_search.facet(:subject_ids).rows.reject{|facet| facet.count < 15}.in_groups_of(4, false).each do |facet_group|
    .grid--full.text--center.hard.push--bottom>
      - facet_group.each do |facet|
        - subject = Subject.find(facet.value)
        - if subject.image?
          - subject_image = subject.image
        - elsif subject.parent and subject.parent.image?
          - subject_image = subject.parent.image
        - elsif subject.grand_parent and subject.grand_parent.image?
          - subject_image = subject.grand_parent.image
        .grid__item.one-quarter.very-soft>
          .relative.show-on-hover__wrapper>
            %a.bg-cover.block{href: structures_path(name: subject.name), title: "Cours de #{subject.name} à #{@city.name}", style: "background-image: url(#{subject_image}); height: 150px;"}>
              .home-screen-gallery__title.text--center
                = subject.name
                .show-on-hover__child.milli #{facet.count} structures

- unless @city_image
  = content_for :scripts do
    :javascript
      $(function() {
          handler = Gmaps.build('Google');
          handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
              markers = handler.addMarkers(#{@city_latlng.to_json});
              handler.bounds.extendWith(markers);
              handler.fitMapToBounds();
          });
          google.maps.event.addListener(handler.getMap(), 'tilesloaded', function() {
              handler.getMap().setZoom(12);
          });
      });

= content_for :head do
  - if @subject
    %link{rel: 'canonical', href: subject_courses_url(@subject)}
  - else
    %link{rel: 'canonical', href: courses_url}

.grid
  .grid__item= render 'search_form'
  %section.grid__item.three-tenths.hide--lap.hide--palm>
    = render 'side_search_form'
  %section.grid__item.seven-tenths.lap--one-whole.palm--one-whole
    - if params[:subject_id]
      %h1.text--center.delta.push--top.flush--bottom.lbl.lbl--blue Tous les cours et stages de <u>#{@subject.name.downcase}</u> à #{@city.name}
    - else
      %h1.text--center.delta.push--top.flush--bottom.lbl.lbl--blue Tous les cours et stages à #{@city.name}
    %ul.tab-titles
      %li.tab-el.active Par cours
      %li
        - if @subject
          = link_to 'Par établissement', subject_places_path(@subject, name: params[:name]), class: 'tab-el'
        - else
          = link_to 'Par établissement', places_path(name: params[:name]), class: 'tab-el'


    .flexbox.page-entries-wrapper
      .flexbox__item.palm--one-whole
        %p.flush--bottom= page_entries_info @courses, entry_name: Course.model_name.human.downcase
        .spoken-form
          %label Trier par :
          %select#filter-select{name: 'sort'}
            %option{value: 'relevancy', selected: (params[:sort] == 'relevancy') } Pertinence
            %option{value: 'price_asc', selected: (params[:sort] == 'price_asc') } Prix : du plus bas au plus élevé
            %option{value: 'price_desc', selected: (params[:sort] == 'price_desc')} Prix : du plus élevé au plus bas
            %option{value: 'rating_desc', selected: (params[:sort] == 'rating_desc')} Notes : les cours les mieux notés en premier
      .flexbox__item.hide--palm
        .text--right= paginate @courses, window: 1, outer_window: 1
    - if @courses.empty?
      = render 'no_results'
    - else
      %ul.block-list.course-list
        = render partial: 'courses/course', :collection => @courses

    %footer.g.one-whole
      = paginate @courses, window: 2, outer_window: 1
= content_for :scripts do
  :javascript
      window.addEvent('domready', function() {
          $('filter-select').addEvent('change', function() {
              $('hidden-sort-input').set('value', this.value);
              $('submit_search_form').click();
          });
          $$('[data-type=course-element]').each(function(course_element) {
              course_element.addEvent('click', function(event) {
                  // Change url only if user doesn't click on link
                  if (event.target.nodeName !== 'A') {
                      if (event.meta || event.control) {
                          window.open(this.get('data-url'));
                      } else {
                          window.location = this.get('data-url');
                      }
                      return false;
                  }
              });
          });
      });

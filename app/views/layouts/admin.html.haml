= content_for :header do
  = render 'shared/headers/pro'

= content_for :content do
  - if @structure
    .pro-top-menu.darkgray-box.flexbox{ data: { behavior: 'sticky', z: 1000 } }
      .flexbox__item.v-middle.soft-half--left{ style: 'width: 40px;' }
        - if @structure.logo?
          = link_to edit_pro_structure_url(@structure, subdomain: 'pro'), class: 'block push-half--right' do
            = image_tag @structure.logo.url(:thumb), width: 40, height: 40, class: 'block'
        - else
          = link_to '', edit_pro_structure_url(@structure, subdomain: 'pro'), class: 'fa-2x fa fa-picture-o soft-half muted-link white', data: { toggle: 'popover', content: "Ajouter un logo", placement: 'right', trigger: 'hover' }
      .flexbox__item.v-middle
        %h5.flush--bottom.white.inline-block.v-middle
          = link_to edit_pro_structure_url(@structure, subdomain: 'pro'), class: 'block semi-muted-link' do
            = @structure.name
        %span.push-half--sides= '|'
        - if @structure.premium?
          = link_to premium_pro_structure_url(@structure, subdomain: 'pro'), class: 'yellow' do
            Premium
            %i.fa.fa-check
        - else
          = link_to premium_modal_pro_structure_url(@structure, subdomain: 'pro'), class: 'btn btn--yellow f-weight-bold fancybox.ajax', data: { behavior: 'modal', padding: 0, width: 900 } do
            %i.fa.fa-star
            Passer au Premium
      .flexbox__item.v-middle.text--right.soft-half--right

        - unread_conversations       = @structure.mailbox.inbox(read: false)
        - unread_conversations      += @structure.unanswered_information_message
        - unread_conversations_count = unread_conversations.count
        .inline-block.v-middle.drop-down__wrapper{ data: { behavior: 'drop-down', el: '> .drop-down__el', position: 'right' } }
          = link_to pro_structure_conversations_url(@structure, subdomain: 'pro'), class: 'white block soft-half--ends muted-link f-weight-bold' do
            %i.fa.fa-envelope
            = pluralize @structure.mailbox.inbox.count, 'message'
            - if unread_conversations_count > 0
              %span.push--left.lbl.lbl--orange.lbl--small= unread_conversations_count
          .drop-down__el
            %ul.no-bullet-list.flush{ style: 'width: 400px' }
              - if unread_conversations_count == 0
                %li
                  %a.not-hoverable.f-weight-normal Pas de nouveau message
              - else
                %li
                  - if unread_conversations_count == 1
                    %a.not-hoverable.f-weight-normal= "#{unread_conversations_count} nouveau message"
                  - else
                    %a.not-hoverable.f-weight-normal= "#{unread_conversations_count} nouveaux messages"
              - unread_conversations.each do |conversation|
                %li
                  = link_to pro_structure_conversation_path(@structure, conversation), class: 'grid--full' do
                    .grid__item.two-twelfths.v-middle>
                      -# - azD?
                      -# - recipients = conversation.recipients.reject{ |recipient| recipient == @structure.main_contact }
                      - last_sender = conversation.messages.order('created_at DESC').first.sender
                      = image_tag last_sender.avatar_url(:thumb), class: 'block bordered rounded--circle'
                    .grid__item.six-twelfths.v-top.text--left.soft-half--left.f-weight-normal>
                      %strong= conversation.subject
                      %br
                      = last_sender.name
                    .grid__item.four-twelfths.v-middle.text--right.f-weight-normal>
                      .grid--full
                        .grid__item.v-middle.ten-twelfths>
                          = conversation_label_name conversation
                        .grid__item.v-middle.two-twelfths>
                          = conversation_label conversation, class: 'lbl--small'
              %li= link_to 'Voir tous les messages', pro_structure_conversations_url(@structure, subdomain: 'pro')
        %span.v-middle.push-half--sides= '|'
        .inline-block.v-middle.drop-down__wrapper{ data: { behavior: 'drop-down', el: '> .drop-down__el', position: 'right' } }
          = link_to pro_structure_comments_url(@structure, subdomain: 'pro'), class: 'white block soft-half--ends muted-link f-weight-bold' do
            %i.fa.fa-comment
            = "#{@structure.comments.accepted.count} avis"
            - if @structure.comments.pending.count > 0
              %span.push--left.lbl.lbl--orange.lbl--small= "#{@structure.comments.pending.count}"
          .drop-down__el
            %ul.no-bullet-list.flush{ style: 'width: 350px' }
              - if @structure.comments.pending.count == 0
                %li
                  %a.not-hoverable.f-weight-normal Pas d'avis en attente
              - else
                %li
                  %a.not-hoverable.f-weight-normal= "#{@structure.comments.pending.count} avis en attente de validation"
              - @structure.comments.pending.each do |comment|
                %li
                  = link_to pro_structure_comments_url(@structure, subdomain: 'pro'), class: 'grid--full' do
                    .grid__item.two-twelfths.v-middle>
                      = image_tag comment.user.avatar_url(:small), height: 30, width: 30, class: 'bordered rounded--circle'
                    .grid__item.ten-twelfths.f-weight-normal.text--left>
                      %strong= comment.author_name
                      %br
                      = comment.email
              %li= link_to 'Voir tous les avis', pro_structure_comments_url(@structure, subdomain: 'pro')
        %span.v-middle.push-half--sides= '|'
        = link_to structure_url(@structure, subdomain: 'www'), class: 'white v-middle', target: :_blank do
          .fa.fa-eye
          Voir mon profil public

  .flexbox
    - if content_for? :side_menu
      %nav.flexbox__item.v-top.border-none--right.side-menu
        .border-none--right.side-menu.side-menu--sticky.gray-box.west{ data: { behavior: 'sticky', 'offset-top' => 45} }
          = yield :side_menu
    .flexbox__item.v-top.small-container
      = yield :breadcrumb
      = content_for?(:admins_content) ? yield(:admins_content) : yield
    .grid__item.relative.wizard-container

= render :template => 'layouts/application'

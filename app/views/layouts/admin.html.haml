= content_for :header do
  = render 'shared/headers/pro'

= content_for :content do
  - if @structure
    .pro-top-menu.darkgray-box.flexbox{ data: { behavior: 'sticky'} }
      .flexbox__item.v-middle.soft-half--left{ style: 'width: 40px;' }
        - if @structure.logo?
          = link_to edit_pro_structure_path(@structure), class: 'block push-half--right' do
            = image_tag @structure.logo.url(:thumb), width: 40, height: 40, class: 'block'
        - else
          = link_to '', edit_pro_structure_path(@structure), class: 'fa-2x fa fa-picture-o soft-half muted-link white', data: { toggle: 'popover', content: "Ajouter un logo", placement: 'right', trigger: 'hover' }
      .flexbox__item.v-middle
        %h5.flush--bottom.white
          = link_to edit_pro_structure_path(@structure), class: 'block semi-muted-link' do
            = @structure.name
      .flexbox__item.v-middle.text--right.soft-half--right
        - unless @structure.premium?
          = link_to premium_modal_pro_structure_path(@structure), class: 'btn btn--yellow f-weight-bold fancybox.ajax', data: { behavior: 'modal', padding: 0, width: 900 } do
            %i.fa.fa-star
            Passer au Premium
          %span.push-half--sides= '|'

        - unread_conversations       = @structure.mailbox.inbox(read: false)
        - unread_conversations_count = unread_conversations.count
        .inline-block.v-middle.drop-down__wrapper{ data: { behavior: 'drop-down', el: '> .drop-down__el', position: 'right' } }
          = link_to pro_structure_conversations_path(@structure), class: 'white block soft-half--ends muted-link f-weight-bold' do
            %i.fa.fa-envelope
            = pluralize @structure.mailbox.inbox.count, 'message'
            - if unread_conversations_count > 0
              %span.push--left.lbl.lbl--yellow.lbl--small= unread_conversations_count
          .drop-down__el
            %ul.no-bullet-list.flush{ style: 'width: 350px' }
              - if unread_conversations_count == 0
                %li.soft-half Pas de nouveau message
              - unread_conversations.each do |conversation|
                %li
                  = link_to pro_structure_conversation_path(@structure, conversation), class: 'grid--full' do
                    .grid__item.two-twelfths.v-middle>
                      - recipients = conversation.recipients.reject{|recipient| recipient == ((@admin || current_pro_admin) || (@user || current_user)) }
                      - last_recipient = recipients.first
                      .media-photo= image_tag recipients.first.avatar_url(:thumb), class: 'block'
                    .grid__item.six-twelfths.v-top.text--left.soft-half--left.f-weight-normal>
                      %strong= conversation.subject
                      %br
                      = last_recipient.name
                    .grid__item.four-twelfths.v-middle.text--right.f-weight-normal.nowrap>
                      %span.v-middle= conversation_label_name conversation
                      = conversation_label conversation, class: 'v-middle lbl--small'
              %li= link_to 'Voir tous les messages', pro_structure_conversations_path(@structure)
        %span.push-half--sides= '|'
        .inline-block.v-middle.drop-down__wrapper{ data: { behavior: 'drop-down', el: '> .drop-down__el', position: 'right' } }
          = link_to pro_structure_comments_path(@structure), class: 'white block soft-half--ends muted-link f-weight-bold' do
            %i.fa.fa-comment
            = "#{@structure.comments.accepted.count} avis"
            - if @structure.comments.pending.count > 0
              %span.push--left.lbl.lbl--yellow.lbl--small= "#{@structure.comments.pending.count}"
          .drop-down__el
            %ul.no-bullet-list.flush{ style: 'width: 350px' }
              - if @structure.comments.pending.count == 0
                %li Pas d'avis en attente
              - @structure.comments.pending.each do |comment|
                %li
                  = link_to pro_structure_comments_path(@structure), class: 'grid--full' do
                    .grid__item.two-twelfths.v-middle>
                      = image_tag comment.user.avatar_url(:small), height: 30, width: 30, class: 'bordered rounded--circle'
                    .grid__item.ten-twelfths.f-weight-normal.text--left>
                      %strong= comment.author_name
                      %br
                      = comment.email
              %li= link_to 'Voir tous les avis', pro_structure_comments_path(@structure)
        %span.push-half--sides= '|'
        = link_to structure_url(@structure, subdomain: 'www'), class: 'white', target: :_blank do
          .fa.fa-eye
          Voir mon profil public

  .flexbox
    - if content_for? :side_menu
      %nav.flexbox__item.v-top.border-none--right.side-menu
        .border-none--right.side-menu.side-menu--sticky.gray-box.west{ data: { behavior: 'sticky', 'offset-top' => 45} }
          = yield :side_menu
    .flexbox__item.v-top.small-container
      = yield :breadcrumb
      = content_for?(:admins_content) ? yield(:admins_content) : yield
    .grid__item.relative.wizard-container

= render :template => 'layouts/application'

- params[:sort]                ||= 'relevancy'
- params[:radius]              ||= 10
%section
  - if @subject
    - search_path = subject_places_path(@subject)
  - else
    - search_path = places_path

  = form_tag search_path, method: :get, authenticity_token: false, class: 'g one-whole', id: 'header-search' do
    .header-search-bar
      %div.search-input-wrapper
        %input#search-input{class: 'search-input', placeholder: 'Que voulez-vous faire ?', type: 'search', name: 'name', value: params[:name], autofocus: true, list: 'subject-list', autocomplete: 'off'}
      .aListCon
        %datalist#subject-list
        <!--[if IE 9]><select disabled><![endif]-->
        - cache "all_subjects_#{ENV["ETAG_VERSION_ID"]}" do
          - Subject.all.each do |subject|
            %option{value: subject.name}
        <!--[if IE 9]></select><![endif]-->
      %p#search-help.white-box.hidden{style: 'z-index: 2; line-height: 1.3; padding: 5px 10px; widht: 100%; position: absolute;'} Recherchez par intitulé de cours, discipline, nom de structure, etc.
      %div.search-input-wrapper
        .input-with-icon
          %input#adress-picker{class: 'search-input', placeholder: 'Où ?', type: 'text', 'data-list' => 'address-list', 'data-behavior' => 'address-picker', 'data-lng' => 'address-lng', 'data-lat' => 'address-lat', autocomplete: 'off', name: 'address_name', value: params[:address_name]}
          %i.icon-map-marker.delta
          %ul#address-list.address-list.hidden
      %input#address-lat{type: 'hidden', name: 'lat', value: params[:lat]}
      %input#address-lng{type: 'hidden', name: 'lng', value: params[:lng]}

      %div.button-wrapper
        %button.btn.btn__primary{type: 'submit', id: 'submit_search_form'}
          %i.icon-search
          Rechercher
    .accessibility
      %input#hidden-sort-input{type: 'hidden', name: 'sort', value: params[:sort]}
      %input#radius-hidden-input{type: 'hidden', name: 'radius', value: params[:radius]}

= content_for :scripts do
  :javascript
    window.addEvent('domready', function() {
      var myAutocomplete = new Autocomplete("search-input", {
        useNativeInterface : false,
        srcType : "dom"
      });
      $('search-input').addEvent('blur', function(){
          $('search-help').addClass('hidden');
      });
      $('search-input').addEvent('click', function(){
          if (this.value.length === 0) {
              $('search-help').removeClass('hidden');
          }
      });
    })

- if cookies[:delete_cookies]
  - cookies.delete :comment_rating , domain: request.host
  - cookies.delete :comment_content, domain: request.host
  - cookies.delete :delete_cookies , domain: request.host

- if @structure_comments.empty? and @structure_comments.empty?
  %p.white-box.islet.text--center
    Ce cours n'a pas encore d'avis.
    %br
    %b Soyez le premier à nous donner votre avis !

.islet.white-box#new-comment{class: (@structure_comments.empty? and @structure_comments.empty? ? '' : 'hidden')}
  = simple_form_for @comment, url: comments_path do |f|
    = f.hidden_field :commentable_type
    = f.hidden_field :commentable_id
    .input
      = f.label :rating
      %span.rating
        %i.star.icon-star-empty.gamma{style: 'top: 4px;', data: {value: 1}}
        %i.star.icon-star-empty.gamma{style: 'top: 4px; left: -3px; padding: 0 2px', data: {value: 2}}
        %i.star.icon-star-empty.gamma{style: 'top: 4px; left: -6px; padding: 0 2px', data: {value: 3}}
        %i.star.icon-star-empty.gamma{style: 'top: 4px; left: -9px; padding: 0 2px', data: {value: 4}}
        %i.star.icon-star-empty.gamma{style: 'top: 4px; left: -12px; padding: 0 2px', data: {value: 5}}
      %span#rating-description
    = f.input :rating, as: :hidden, input_html: {value: cookies[:comment_rating]}
    = f.input :content, label_html: {style: 'vertical-align: top;'}, input_html: {style: 'height: 50px;', 'data-behavior' => 'autoresize', value: cookies[:comment_content]}, placeholder: "Qu'avez-vous pensé du cours ?"
    .text--center
      - if current_user
        = f.submit 'Publier mon avis', class: 'btn btn--large btn--success', style: 'padding-top: 6px; padding-bottom: 6px;'
      - else
        = link_to 'Publier mon avis', '#', class: 'btn btn--large btn--success', style: 'padding-top: 6px; padding-bottom: 6px;', onclick: "_gaq.push(['_trackEvent', 'Avis sur établissement', 'click','Non inscrit'])", data: {behavior: 'modal', title: 'Connectez-vous pour commenter', width: '400px', url: '/users/sign_up'}

= render 'comments/javascript'

- if @comments.any?
  %ul.comment-list
    = render partial: 'comments/comment', collection: @comments, show_title: false
  %hr
- if @structure_comments.any?
  %h4.small-margin-bottom Avis sur l'établissement
  %ul.comment-list
    = render partial: 'comments/comment', collection: @structure_comments, show_title: true

= content_for :scripts do
  :javascript
    window.addEvent('domready', function() {
        if ( $('comment_rating').get('value').length > 0
            || $('comment_content').get('value').length > 0) {
            $('new-comment').reveal();
        }
        $('comment_rating').addEvent('change', function() {
            Cookie.write('comment_rating', this.get('value'));
        });
        $('comment_content').addEvent('change', function() {
            Cookie.write('comment_content', this.get('value'));
        });
    });

- form_url = @guide.persisted? ? pro_guide_path(@guide) : pro_guides_path

= simple_form_for @guide, url: form_url do |f|
  = f.input :title, label: 'Titre', label_html: { class: 'label--large' }, input_html: { class: 'input--large', placeholder: t('guides.placeholder.title') }
  = f.input :description, label: 'Description', label_html: { class: 'label--large' }, input_html: { placeholder: t('guides.placeholder.description') }
  = f.input :call_to_action, label: 'Accroche', label_html: { class: 'label--large' }, input_html: { placeholder: t('guides.placeholder.call_to_action') }
  = f.input :age_dependant, label: "Dependant de l'age ?", label_html: { class: 'label--large' }, input_html: { data: { behavior: 'toggle-restrictions' } }

  %hr.push--top

  %div{ data: { behavior: 'show-more-on-demand' } }
    = f.simple_fields_for :questions, @guide.questions do |qf|
      - question = qf.object
      %div{ class: (question.persisted? ? '': 'hidden'), data: { el: true, hidden: (!question.persisted? and qf.index > 0) } }
        = qf.input :content, label: 'Question', label_html: { class: 'label--large' }, input_html: { class: 'input--large', placeholder: t('guides.placeholder.question.content') }
        = qf.input :ponderation, label: 'Ponderation', input_html: { placeholder: '0' }

        %a.cursor-pointer.v-middle{ href: 'javascript:void(0);', data: { toggle: true } }
          %i.fa-eye
          Réponses
        .bordered.bordered--dash.bordered--larger.f-weight-500{ class: (question.answers.map(&:content).any? ? '' : 'hidden'), data: { content: true } }
          = qf.simple_fields_for :answers, question.answers do |af|
            - answer = af.object
            .grid.soft--top.soft--ends
              .grid__item.one-quarter
                .soft--left.text--center
                  - if answer.image.present?
                    = image_tag answer.image.url, class: 'block', data: { fpimage: true }
                    = af.filepicker_field :remote_image_url, services: 'COMPUTER,FACEBOOK,INSTAGRAM,DROPBOX,BOX,FLICKR,PICASA,URL', dragdrop: false, button_text: "Changer l'image",
                      button_class: 'btn btn--blue btn--small push-half--top filepicker', onchange: 'onPhotoUpload(event)'
                  - else
                    %img{ data: { fpimage: true } }
                    = af.filepicker_field :remote_image_url, button_class: 'hidden', services: 'COMPUTER,FACEBOOK,INSTAGRAM,DROPBOX,BOX,FLICKR,PICASA,URL', dragdrop: true,
                      class: "filepicker-dragdrop text--center", drag_class: "flush--left push-half--bottom one-whole f-weight-500 soft-half--ends text--center push--bottom",
                      drag_text: "Glissez ou cliquez ici pour changer votre image", onChange: 'onPhotoUpload(event)'
              .grid__item.seven-tenths
                = af.input :content, label: 'Reponse', label_html: { class: 'label--large' }, input_html: { class: 'input--large', placeholder: t('guides.placeholder.answer.content') }
                = af.input :subject_ids, as: :select, collection: Subject.order('position ASC'), label: 'Disciplines', label_method: :name,
                  input_html: { data: { behavior: 'chosen', placeholder: 'Sélectionnez une ou plusieurs disciplines', autocomplete: "false" }, multiple: true }

            %hr.push-half--ends

        .text--right
          %a.cursor-pointer.v-middle{ href: 'javascript:void(0);', data: { clear: true } }
            %i.fa-trash-o
            Supprimer la question
        %hr.push-half--ends

    .push--ends
      %a{ href: 'javascript:void(0)', data: { trigger: true } }>
        %i.fa.fa-plus
        Ajouter une question

  = f.submit 'Enregistrer', class: 'btn btn--green btn--full', data: { disable_with: "En cours d'enregistrement"}

- content_for :scripts do
  = filepicker_js_include_tag

  :javascript
    function onPhotoUpload(event) {
        var image = $(event.target).siblings('[data-fpimage]');
        $(image).attr('src', event.fpfile.url);
    }

    $(document).ready(function() {
        $('[data-toggle]').click(function(event) {
            event.preventDefault();
            $(this).siblings('[data-content]').slideToggle()
        });

        $('[data-behavior=toggle-restrictions]').change(function(event) {
          if (event.target.checked) {
              $('#age-restrictions').show();
          } else {
              $('#age-restrictions').hide();
          }
        });

    //  $('#guide_description').redactor({
    //      buttons: ['formatting', 'bold', 'italic', 'unorderedlist', 'orderedlist',
    //        'link', 'alignment', 'horizontalrule', 'image'],
    //      formatting: ['p', 'blockquote', 'h1', 'h2', 'h3'],
    //      lang: 'fr'
    //  });
    });

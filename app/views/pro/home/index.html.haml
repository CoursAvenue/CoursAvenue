= content_for :after_ga do
  <script src="//www.google-analytics.com/cx/api.js?experiment=5MBOH-VVRzWRjzbgMSPTHA"></script>

= content_for :title do
  Développez votre bouche à oreille sur Internet
= pro_menu_currently_at 'Accueil'

- content_for :above_container do
  .home-screen-promotion-wrapper.island.one-whole.soft--top
    %h1.text--center.blue.flush
      Développez votre bouche à oreille sur Internet
    .delta.push--bottom.text--center Toutes les recommandations de vos élèves sur CoursAvenue et votre site Internet
    .text--center
      - if current_pro_admin
        - if current_pro_admin.super_admin?
          = link_to "Accéder à mon profil", pro_dashboard_path, class: 'btn btn--green btn--large', id: 'register'
        - else
          = link_to "Accéder à mon profil", dashboard_pro_structure_path(current_pro_admin.structure), class: 'btn btn--green btn--large', id: 'register'
      - else
        = link_to "Créer mon profil gratuit", inscription_pro_structures_path, class: 'btn btn--green btn--large', id: 'register'
    - unless current_pro_admin
      .text--center= link_to "Je suis déjà inscrit, me connecter", new_pro_admin_session_url(subdomain: 'pro')

  .main-container.grid--full.text--center.push--top.visuallyhidden--palm
    .grid__item.text--center.v-middle.relative{style: 'width: 27%;'}>
      = link_to inscription_pro_structures_path, class: 'muted-link white-box white-box--rounded islet word-break-normal', data: {toggle: 'popover', content: "En quelques minutes, renseignez vos informations générales, vos lieux d'enseignements, vos cours et vos photos & vidéos.", 'original-title' => 'Créez un profil complet en 5min !', trigger: 'hover', placement: 'top'} do
        %h5
          = image_tag 'icons/profile.png', height: 30
          %br
          Créez votre profil
    .grid__item.one-twelfth.text--center.v-middle>
      .islet
        %i.fa.fa-chevron-right.fa.fa-2x
    .grid__item.text--center.v-middle.relative{style: 'width: 27%;'}>
      = link_to inscription_pro_structures_path, class: 'muted-link white-box white-box--rounded islet word-break-normal', data: {toggle: 'popover', content: "Grâce à notre outil dédié, envoyez un email à tous vos élèves pour qu'ils vous recommandent. Au-delà de 5 recommandations, affichez votre livre d'or sur votre propre site !".html_safe, 'original-title' => 'Solicitez vos élèves les plus fidèles', trigger: 'hover', placement: 'top'} do
        %h5
          %i.fa.fa-star-o.fa.fa-2x
          %i.fa.fa-star-o.fa.fa-2x.relative
          %i.fa.fa-star-o.fa.fa-2x.relative
          %i.fa.fa-star-o.fa.fa-2x.relative
          %i.fa.fa-star-o.fa.fa-2x.relative
          %br
          Demandez des recommandations
    .grid__item.one-twelfth.text--center.v-middle>
      .islet
        %i.fa.fa-chevron-right.fa.fa-2x
    .grid__item.text--center.v-middle.relative{style: 'width: 27%;'}>
      = link_to inscription_pro_structures_path, class: 'muted-link white-box white-box--rounded islet word-break-normal', data: {toggle: 'popover', content: "Maintenant que vous avez un profil complet, laissez les élèves venir à vous et répondez à leur messages via notre messagerie interne.", 'original-title' => 'Laissez-nous faire', trigger: 'hover', placement: 'top'} do
        %h5
          %i.fa.fa-group.fa.fa-2x
          %br
          Attirez de nouveaux élèves

  .home-screen-promotion-wrapper.soft--top
    .text--center
      %h3
        Ils ont déjà leur livre d'or :
    #home-index-structures.home-index-structures.main-container.stickem-container.relative{ data: { type: 'home-index-structures-root' }}

:javascript
  // there is a work around below: https://github.com/rails/rails/issues/10320
  window.coursavenue = window.coursavenue || {};
  window.coursavenue.bootstrap = {
    options: {
      total: #{ @structures.length }
    },
    models: #{ @structures.to_json.gsub(/\u2028/, '\u2028').gsub(/\u2029/, '\u2029') }
  };

= content_for :scripts do
  :javascript
      $(function() {
        $('body').stickem();
        $('[data-type=structure-element]').each(function(index, place_element) {
            $(this).click(function(event) {
                // Change url only if user doesn't click on link
                if (typeof ga !== 'undefined') { ga('send', 'event', 'Go to other profile', 'click', 'From pro home page'); }
                if (event.target.nodeName !== 'A') {
                    window.open(this.dataset.url);
                    return false;
                }
                return false;
            });
        });
        handler = Gmaps.build('Google');
        handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
            markers = handler.addMarkers(#{@json_locations_addresses.to_json});
            handler.bounds.extendWith(markers);
            handler.fitMapToBounds();
        });
        $("img").lazyload({
            effect : "fadeIn"
        });
    });

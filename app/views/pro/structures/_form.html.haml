%h1.header-group
  %i.icon-user
  Édition du profil
.islet
  = simple_form_for [:pro, @structure], html: { autocomplete: 'off', id: 'structure-form' } do |structure_form|
    .form-inputs
      %h5.form-header-group
        %i.icon-picture
        Image / Logo
      .form-white-box
        .text--center
          - if @structure.image?
            = image_tag @structure.image.url(:normal), height: 200, id: 'logo-image'
            %br
            %a.red#delete-image{href: 'javascript:void(0)'} Supprimer l'image
            .visuallyhidden= structure_form.input :delete_image, as: :boolean, label: false
          - else
            %img.center-block#logo-image{style: 'max-height: 200px'}
        .input.flush--top
          - unless @structure.new_record? || !@structure.image?
            .control-label Changer l'image
          - else
            .control-label Image ou logo pour vous illustrer
          = structure_form.input :image, label: false

      %h5.form-header-group
        %i.lbc-icon-info i
        Informations
      .form-white-box
        = structure_form.input :name, label: t('.structure_name'), wrapper_html: {class: 'flush--bottom'}
        %p.field-form-info.blue= t('.structure_name_info')
        = structure_form.input :website, placeholder: 'Ex : http://www.je-danse-a-paris.com'
        = structure_form.input :facebook_url, wrapper_html: {class: 'flush--bottom'}, placeholder: 'Ex. : https://www.facebook.com/CoursAvenue'
        = structure_form.association :subjects , as: :select, collection: (Subject.roots + Subject.children), input_html: {style: 'width: 490px;', 'data-behavior' => 'chosen', multiple: true}, label: 'Disciplines pratiquées ', label_method: lambda{|subj| subj.name }, wrapper_html: {class: 'flush--bottom'}
        = structure_form.input :structure_type, collection: Structure::STRUCTURE_TYPES.map{|structure_type| [ t(structure_type), structure_type]}, input_html: {style: 'max-width: 29em;'}

      / %h5.form-header-group
      /   %i.icon-map-marker
      /   Adresse principale
      / .form-white-box
      /   = structure_form.input :street, wrapper_html: {class: 'flush--bottom'}, label: t('.structure_address')
      /   %p.field-form-info.blue= t('.structure_address_info')
      /   .grid
      /     .grid__item.width-auto
      /       = structure_form.input :zip_code, placeholder: '75008', input_html: { class: 'zip_code', data: {behavior: 'city-autocomplete', el: '#structure_city_id'} }
      /     .grid__item.width-auto
      /       = structure_form.association :city, collection: [@structure.city], label: false

      %h5.form-header-group
        Description
      .form-white-box
        .grid--full.input
          .textarea-with-info.grid__item.width-auto
            .grid--full
              .three-fifths.grid__item.soft-half--right>
                = structure_form.input :description, label: false, wrapper_html: {class: 'flush--top'}, input_html: {id: 'description-textarea', class: 'textarea-description--tall', placeholder: 'Mettez en avant votre différence !', data: { behavior: 'text-counter', 'average-words-nb' => 30, 'good-words-nb' => 100, 'bad-text' => 'Votre description doit comporter au moins 30 mots. Nos Partenaires qui ont le plus de succès ont plus de 100 mots.', 'average-text' => 'Encore quelques mots et vous aurez une superbe description !', 'good-text' => 'Superbe description !'}, value: @structure.description_for_input}
              .two-fifths.grid__item
                %p.alert--info.flush--top
                  Qu'est-ce qui vous différencie ?
                  %br
                  Pourquoi nos Internautes devraient-il réserver chez vous ? Soyez sincère et original !
                %p.alert--info
                  Quelle est votre équipe, combien êtes-vous ?
                  %br
                  Qui se cache derrière tout ça ?
                  %br
                  Quel est le profil de vos professeurs ?
                %p.alert--info
                  Depuis quand votre structure existe-t-elle ?
                  %br
                  Quelle est sa notoriété ?
                  %br
                  A-t-elle formé des célébrités ?
                %p.alert--info Toute autre info sur votre structure est bonne à renseigner !
    .form-actions
      = structure_form.button :submit, "Mettre à jour mes informations", class: 'btn btn--success'
= content_for :scripts do
  :javascript
    $(function() {
        $('#structure_image').change(function(event) {
            if (this.files && this.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#logo-image').attr('src', e.target.result);
                }
                reader.readAsDataURL(this.files[0]);
            }
        });
        if ($('#delete-image').length > 0) {
            $('#delete-image').click(function(){
                $('#structure_delete_image')[0].checked = true;
                $('#structure-form').submit();
            });
        }
        $('#description-textarea').textareaResizer();
    });

- unless params[:not_ajax]
  :css
    .coursavenue-widget {
      font-family: Helvetica, Arial,sans-serif;
      font-size  : 12px;
    }
    .coursavenue-widget-wrapper-link {
      display        : block;
      padding        : 10px;
      margin         : 0 auto 10px auto;
      text-align     : center;
      border         : 1px solid #DDD;
      text-decoration: none;
    }
    .coursavenue-widget-title {
      font-size: 16px;
      color    : #e9683d;
    }
    .coursavenue-link {
      background-color: blue;
    }
    .coursavenue-white-box {
      display               :block;
      font-family           :Helvetica, Arial,sans-serif;
      padding               :10px;
      margin                :0 0 10px 0;
      background-color      :white;
      border                :1px solid #DDD;
      -webkit-border-radius :2px;
      -moz-border-radius    :2px;
      -ms-border-radius     :2px;
      -o-border-radius      :2px;
      border-radius         :2px;
      -webkit-box-shadow    :1px 1px 3px #DDD, 2px 2px 9px #EEE, 4px 4px 24px #EEE;
      -moz-box-shadow       :1px 1px 3px #dddddd, 2px 2px 9px #eeeeee, 4px 4px 24px #eeeeee;
      box-shadow            :1px 1px 3px #DDD, 2px 2px 9px #EEE, 4px 4px 24px #EEE;
      text-decoration       :none;
    }
    .coursavenue-image{
      background: none;
      border    : none;
      padding   : 0;
    }
    .coursavenue-header {
      margin       : 0 0 10px 0;
      font-size    : 14px;
    }
    .coursavenue-btn:hover {
      text-decoration: underline;
    }
    .coursavenue-btn {
      display                  : block;
      margin                   : auto;
      padding                  : 5px;
      background-color         : white;
      border                   : 1px solid #DDD;
      color                    : black;
      -webkit-border-radius    : 2px;
      -moz-border-radius       : 2px;
      -ms-border-radius        : 2px;
      -o-border-radius         : 2px;
      border-radius            : 2px;
    }
    .coursavenue-comment-paragraph{
      font-size      : 13px;
      line-height    : 18px;
      color          : black;
      margin-bottom  : 0;
      margin-top     : 0;
    }
    .coursavenue-comment-footer{
      margin-bottom: 0;
      text-align   : right;
      font-size    : 12px;
      color        : #666;
    }
    .coursavenue-comment-footer i{
      font-style: italic;
    }
    .coursavenue-widget-link:hover {
      color          : #e9683d;
      background     : none;
      text-decoration: underline;
    }
    .coursavenue-widget-link {
      color     : #e9683d;
      background: none;
    }
    .coursavenue-widget-top-logo {
      text-align: center;
    }

.coursavenue-widget
  = link_to structure_url(@structure, subdomain: 'www'), target: '_blank', class: 'coursavenue-white-box coursavenue-widget-wrapper-link', title: "Cours de #{@structure.subjects.map{|subj| subj.name.downcase}.join(', ')} sur CoursAvenue" do
    .coursavenue-widget-top-logo
      .coursavenue-widget-title Recommandé par les élèves sur
      %img.coursavenue-image{src: asset_path('logo.png'), height: 35, style: 'height: 35px;'}
  %p{style: 'text-align: center; margin-bottom: 10px;'}
    = link_to 'Déposer mon avis sur CoursAvenue', new_structure_comment_url(@structure, subdomain: 'www'), class: 'coursavenue-btn', target: '_blank'
  - if params[:last_comments] and params[:last_comments] == 'true'
    - params[:nb_comments] ||= 3
    - params[:nb_comments] = params[:nb_comments].to_i
    - if @structure.comments_count < params[:nb_comments]
      - params[:nb_comments] = @structure.comments_count
    - if params[:nb_comments] > 0
      - @structure.comments.accepted[0..(params[:nb_comments] - 1)].each do |comment|
        .coursavenue-white-box
          %p.coursavenue-header
            = link_to structure_url(@structure, subdomain: 'www', anchor: "recommantation-#{comment.id}"), class: 'coursavenue-widget-link', target: '_blank' do
              %strong= comment.author_name
              = "— #{comment.course_name}"
          - if comment.title.present?
            %p.coursavenue-comment-paragraph
              %strong= "\"#{comment.title}\""
          %p.coursavenue-comment-paragraph
            - omission = link_to('Lire la suite →', structure_url(@structure, subdomain: 'www', anchor: "recommantation-#{comment.id}"), target: '_blank', class: 'coursavenue-widget-link')
            = truncate(comment.content.html_safe, length: 600, omission: "… #{omission}").html_safe
          %p.coursavenue-comment-footer
            %i= "Avis déposé le #{I18n.l(comment.created_at, format: :date)}"
    %p{style: 'text-align: center; margin-bottom: 5px;'}
      = link_to 'Voir tous les avis sur CoursAvenue', structure_url(@structure, subdomain: 'www'), class: 'coursavenue-btn', target: '_blank'


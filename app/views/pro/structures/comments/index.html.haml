= side_menu_currently_at 'comments'
= render partial: 'pro/structures/comments_tabs', locals: { current: 'comments' }

%div{ data: { behavior: 'wizard-helper', content: t('comments.wizard.infos') } }
  .flexbox.push--bottom
    .flexbox__item.v-middle
      %h1.flush Avismessa
    - if @structure.comments.any?
      .flexbox__item.v-middle.text--right
        = link_to recommendations_pro_structure_path(@structure), class: 'btn btn--green' do
          %i.fa.fa-plus
          Obtenir plus d'avis
  - if @structure.comments.any?
    .grid--full.text--center.soft--ends.bordered--ends.push--bottom
      .grid__item.seven-tenths>
        = simple_form_for [:pro, @structure], html: { data: { behavior: 'live-form' } }, remote: true do |f|
          .flexbox
            .flexbox__item.nowrap
              %label.label--large.f-weight-bold.soft--left= Structure.human_attribute_name :highlighted_comment_id
            .flexbox__item
              = f.input :highlighted_comment_id, as: :select, collection: @structure.comments.accepted.order('created_at DESC').reject{ |comment| comment.title.blank? }, label_method: lambda{ |comment| "\"#{comment.title}\"" }, input_html: { class: 'input--large one-whole' }, label: false, wrapper_html: { class: 'flush' }, include_blank: 'Aucun avis'

  - if @waiting_for_deletion_comments.any?
    %h3 Avis en attente de suppression par l'équipe CoursAvenue
    %ul.comment-list
      = render partial: '/comments/comment', collection: @waiting_for_deletion_comments
    %hr.push--ends

  - if @structure.comments.empty?
    .bordered.bordered--dash.bordered--larger.f-weight-500.mega-soft--ends.text--center
      %p.delta.line-height-1-7
        Vous n'avez pas encore reçu d'avis.
        %br
        Demandez à vos élèves leurs recommandations et créez votre
        %br
        livre d'Or à afficher sur votre propre site Internet :
      %div
        = link_to recommendations_pro_structure_path(@structure), class: 'btn btn--green' do
          %i.fa.fa-plus
          Demander des recommandations
  - elsif @comments.any?
    %h3 Vous avez #{@comments.count} avis
    .text--center.push-half--ends= paginate @comments, window: 1, outer_window: 3
    %ul.comment-list
      - @comments.each do |review|
        - cache [review, 'pro/structure/comments/index'] do
          = render partial: 'comments/comment', locals: { with_reply: true, comment: review }
    .text--center.push-half--ends= paginate @comments, window: 1, outer_window: 3


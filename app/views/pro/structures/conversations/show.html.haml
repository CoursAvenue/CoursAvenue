= side_menu_currently_at 'messages'
- recipients = @conversation.recipients.reject{|recipient| recipient == @admin }

.panel
  .panel__header.soft
    %ol.nav.flush.breadcrumb{itemprop: 'breadcrumb'}
      %li.delta= link_to 'Boîte de réception', pro_structure_conversations_path(@structure)
      %li.delta Conversation avec #{truncate(recipients.map{|recipient| recipient.name || recipient.email}.join(', '), length: 50) }
  .panel__body.soft
    .grid
      .grid__item.two-twelfths.v-middle.text--right>
        %p.flush Objet
      .grid__item.ten-twelfths.soft-half--left.v-middle>
        %h5.flush= @conversation.subject
    .grid
      .grid__item.two-twelfths.v-middle.text--right>
        %p À
      .grid__item.ten-twelfths.soft-half--left.v-middle>
        %p= recipients.map(&:name).join(', ')

    - if conversation_extra_infos(@conversation).any?
      .grid
        .grid__item.two-twelfths.v-middle.text--right>
          %strong.flush Infos
        .grid__item.ten-twelfths.soft-half--left.v-middle>
          = conversation_extra_infos(@conversation).map{ |extra_info| t(extra_info.name) }.join(', ').capitalize

    - if conversation_courses(@conversation, @structure).any?
      .grid
        .grid__item.two-twelfths.v-middle.text--right>
          %strong.flush Cours concernés
        .grid__item.ten-twelfths.soft-half--left.v-middle>
          = conversation_courses(@conversation, @structure).map(&:name).join(', ')
    - user = @conversation.recipients.detect{ |recipient| recipient.is_a? User }
    - if user.phone_number.present?
      .grid
        .grid__item.two-twelfths.v-middle.text--right>
          %strong.flush Téléphone
        .grid__item.ten-twelfths.soft-half--left.v-middle>
          = readable_phone_number user.phone_number

    .push--top
      = render 'pro/structures/conversations/form'

    = render partial: 'messages/message', collection: @conversation.messages.order('created_at DESC').reject(&:new_record?)

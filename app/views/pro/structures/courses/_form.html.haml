- if @course.new_record?
  - return_to_action = "$('[data-action=new_course][data-course-type=#{@course.underscore_name}]').click();"
- else
  - return_to_action = "$('[data-course-id=#{@course.id}][data-action=edit]').click();"

- if @course.new_record?
  - url = pro_structure_courses_path(@structure)
- else
  - url = pro_structure_course_path(@structure, @course)

#loader.text--center.island{ style: 'height: 600px;'}
  = image_tag 'gifs/loading-indicator-circle.gif', class: 'center-block', height: 20, style: 'margin-top: 290px;'
#content.hidden
  = simple_form_for [:pro, @structure, @course], url: url, as: :course, html: { id: 'course-form' }, remote: true do |f|
    = f.input :type, as: :hidden
    .panel
      .panel__header.soft
        %h4.flush.inline-block.v-middle
          %span.v-middle
            Nom du #{@course.type_name.downcase}
          = f.input :name, label: false, input_html: { class: 'input--large', style: 'width: 20em;' }, wrapper_html: { class: 'inline-block v-middle flush--ends push-half--left' }
        %p.flush
          %i.blue
            Un bon nom doit être court et explicite (aucune information sur le lieu ou le niveau).

      .panel__body.soft--ends
        .soft--sides
          .input.chosen-input.flush--bottom>
            = f.label :subjects, class: 'label--large nowrap'
            - subjects = @structure.subjects.little_children.uniq
            - if subjects.empty?
              - subjects = @structure.subjects.roots.map(&:little_children).flatten
            .input-container>
              = f.association :subjects , as: :select, collection: subjects, input_html: { class: 'input--large hard', data: { behavior: 'chosen', placeholder: 'Sélectionnez une ou plusieurs disciplines' }, multiple: true }, label: t('.subjects'), selected: @course.subject_ids, label_method: lambda{|subj| subj.name }, wrapper_html: { class: 'flush' }, label: false
              = link_to add_subjects_pro_structure_path(@structure, return_to_action: return_to_action, anchor: 'informations'), class: 'fancybox.ajax', data: { behavior: 'modal', width: 650 } do
                %i.fa.fa-plus
                Ajouter des disciplines à mon profil

        - if @course.is_lesson?
          .soft--sides
            .input.depend-on-reccurent-course{ data: { behavior: 'date-range', 'start-date' => '#course_start_date', 'end-date' => '#course_end_date' } }>
              %label.label--large.control-label{ for: 'course_start_date' } Date du premier et dernier cours
              = f.input :start_date, as: :string, label: false, input_html: { style: 'margin-right: 5px', class: 'datepicker-input input--large', value: (@course.start_date.present? ? l(@course.start_date) : l(Date.parse('15/09/2014'))), data: { behavior: 'datepicker' } }
              .soft--ends.inline-block -&nbsp;
              - next_june = Date.parse("28 June #{Date.today.year + 1}")
              = f.input :end_date, as: :string, label: false, input_html: { class: 'datepicker-input input--large', value: (@course.end_date.present? ? l(@course.end_date) : l(next_june)), 'data-behavior' => 'datepicker' }
            = f.input :frequency, as: :select, collection: Course::COURSE_FREQUENCIES, label_method: lambda {|course_frequency| t(course_frequency)}, default: Course::COURSE_FREQUENCIES.first, label: t('.frequency'), wrapper_html: { class: 'depend-on-reccurent-course' }, label_html: { class: 'label--large' }, input_html: { class: 'input--large' }
            .input.flush
              %label.control-label.label--large> Infos
              .input-container>
                %div
                  = f.input :cant_be_joined_during_year, label: false, wrapper_html: { class: 'inline-block v-middle' }, input_html: { class: 'input--large' }
                  %label.inline-block.v-middle.label--large{ for: 'course_cant_be_joined_during_year' }= Course.human_attribute_name :cant_be_joined_during_year

                %div
                  = f.input :no_class_during_holidays, label: false, wrapper_html: { class: 'inline-block v-middle' }, input_html: { class: 'input--large' }
                  %label.inline-block.v-middle.label--large{ for: 'course_no_class_during_holidays' }= Course.human_attribute_name :no_class_during_holidays

        .soft--sides
          .input
            = f.label :description, class: 'label--large'
            .input-container>
              = f.input :description, as: :text, label: false, input_html: { class: 'input--large one-whole', data: { behavior: 'text-counter', 'average-words-nb' => 20, 'good-words-nb' => 50, 'bad-text' => 'Votre description doit comporter au moins 20 mots. Nos Partenaires qui ont le plus de succès ont plus de 50 mots', 'average-text' => 'Encore quelques mots et vous aurez une superbe description !', 'good-text' => 'Superbe description !' } }, wrapper_html: { class: 'flush--top one-whole' }

          - if @course.is_private?
            .input
              %label.control-label.label--large.v-top> Lieux
              .input-container.v-middle>
                - home_place = @structure.places.homes.first
                %div
                  = f.input :teaches_at_home, input_html: { class: 'input--large', disabled: home_place.nil? }, label: false, wrapper_html: { class: 'inline-block v-middle' }
                  = f.label :teaches_at_home, class: "label--large inline-block v-middle width-auto hard #{home_place.nil? ? 'gray-light' : ''}"
                  - if home_place
                    .inline-block.v-middle.soft-half--left
                      %i.blue Dans un rayon de #{home_place.radius}km autour de #{home_place.city.name}.
                      = link_to edit_pro_structure_place_path(@structure, @structure.places.homes.first, type: 'Place::Home', return_to_action: return_to_action), class: 'fancybox.ajax', data: { behavior: 'modal', width: '650', padding: 0 } do
                        %i.fa.fa-pencil
                        Modifier
                  - else
                    %div
                      = link_to new_pro_structure_place_path(@structure, type: 'Place::Home', return_to_action: return_to_action), class: 'fancybox.ajax', data: { behavior: 'modal', width: '650', padding: 0 } do
                        %i.fa.fa-plus
                        Ajouter la zone géographique pour mes cours à domicile
                %div
                  %label.inline-block.label--large{ for: 'course_place_id_checkbox' }
                    %input#course_place_id_checkbox{ type: 'checkbox' }
                    Les cours ont lieu à cette adresse :
                  = f.input :place_id, as: :select, collection: @structure.places.publics, input_html: { class: 'input--large', style: 'max-width: 13em;' }, label: false, wrapper_html: { class: 'inline-block v-middle' }, include_blank: 'Sélectionnez une adresse'

            = f.input :on_appointment, as: :select, collection: [["Cours particuliers selon des créneaux précis", false], ["Pas de créneau précis, uniquement sur demande", true]], label_html: { class: 'label--large' }, input_html: { class: 'input--large' }, label: 'Disponibilités', include_blank: false


            = f.input :level_ids, as: :check_boxes, collection: Level.all, label_method: lambda {|level| t(level.name)}, label: t('planning.levels'), wrapper_html: { data: { behavior: 'checkbox-list' } }, label_html: { class: 'label--large v-middle' }, input_html: { class: 'input--large' }

            = f.input :audience_ids, as: :check_boxes, collection: Audience.all, label_method: lambda {|audience| t(audience.name)}, label: t('planning.audiences'), input_html: { class: 'input--large' }, label_html: { class: 'label--large v-middle' }

            .input#children-ages{class: f.object.audiences.include?(Audience::KID) ? '' : 'hidden'}
              %label.label--large.control-label.v-middle Âge pour les enfants (optionnel)
              %span.v-middle.label--large de
              = f.input :min_age_for_kid, label: false, input_html: { class: 'input--large', style: 'width: 5em;', value: f.object.min_age_for_kid || 0}, wrapper_html: {class: 'flush v-middle'}
              %span.v-middl.label--large  à
              = f.input :max_age_for_kid, label: false, input_html: { class: 'input--large', style: 'width: 5em;', value: f.object.max_age_for_kid || 18}, wrapper_html: {class: 'flush v-middle'}
              %span.v-middle ans

          %input#save-and-add-planning-input{ name: 'add_planning', type: 'hidden', value: 'true' }
          .grid.push--top
            .grid__item.two-tenths>
              %a.btn.btn--gray.btn--full{ onclick: '$.fancybox.close()' } Annuler
            .grid__item.eight-tenths>
              = f.submit (@course.is_private? ? 'Enregistrer et ajouter mes disponibilités' : 'Enregistrer et ajouter un créneau'), class: 'btn btn--green btn--full push--bottom', data: { disable_with: 'Enregistrement en cours...' }, id: 'save-and-add-planning'

:javascript
  $('textarea').textareaResizer();
  setTimeout(function() {
      $('#loader').hide();
      $('#content').show();
  }, 400);

- if @course.is_private?
  :javascript
      if ($('[name="course[audience_ids][]"]').length > 0) {
          $('[name="course[audience_ids][]"]').change(function(event) {
              if (event.target.value == '1') {
                  if (event.target.checked) {
                      $('#children-ages').removeClass('hidden');
                  } else {
                      $('#children-ages').addClass('hidden');
                  }
              }
          });
      }
      $('#course_place_id').change(function() {
          $('#course_place_id_checkbox')[0].checked = (this.value != '');
      });
      $('#course_on_appointment').change(function() {
          if (this.value == 'true') {
              $('#save-and-add-planning-input').val('false');
              $('#save-and-add-planning').val('Enregistrer');
          } else {
              $('#save-and-add-planning-input').val('true');
              $('#save-and-add-planning').val('Enregistrer et ajouter mes disponibilités');
          }
      });
      $('#course_on_appointment').change()

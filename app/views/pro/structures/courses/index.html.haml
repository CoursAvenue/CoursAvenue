= side_menu_currently_at 'Mes cours'

- unless cookies[:understood__course_places]
  %p.alert--info#course-places-info
    %i.fa.fa-warning-sign
    %b Important : si un cours possède plusieurs lieux, plusieurs niveaux, pour des publics différents, renseignez-le dans la partie "planning", mais n'ajoutez pas de nouveau cours.
    %a#understood__course_places{href: 'javascript:void(0)'} J'ai compris

- if @courses.any?
  %table.table--striped.dataTable.table--data.white-box.flush--bottom
    %thead
      %tr
        %th.text--center.one-twelfth Statut
        %th{style: 'width: 14%'}
          %span Type
        %th.sortDesc.two-twelfths
          %span Nom
        %th.four-twelfths
        %th{style: 'width: 12%'}
    %tbody
      - @courses.each do |course|
        %tr{data: {id: course.id}}
          %td.text--center
            - if course.active
              = link_to disable_pro_structure_course_path(@structure, course), method: :patch, class: 'switch-button on', title: 'Enlever le cours de CoursAvenue' do
                Visible
            - else
              = link_to activate_pro_structure_course_path(@structure, course), method: :patch, class: 'switch-button off', title: 'Afficher le cours sur CoursAvenue'  do
                Non&nbsp;visible
          %td= course.type_name
          %td
            - if course.latest_end_date and course.latest_end_date < Date.today
              .warning-buble{data: {behavior: 'tooltip', 'original-title' => 'Le planning du cours est périmé.'}}
                !
            = link_to course.name, edit_pro_structure_course_path(@structure, course)
          %td.text--right.nowrap
            .btn-group
              .btn>
                = link_to edit_pro_structure_course_path(@structure, course) do
                  %i.lbc-icon-info i
                  Info
                  %i.fa.fa-check.green
              .btn>
                = link_to pro_structure_course_prices_path(@structure, course) do
                  € Tarifs
                  - if course.prices.empty?
                    %i.fa.fa-times.red
                  - else
                    %i.fa.fa-check.green
              .btn>
                = link_to pro_structure_course_plannings_path(@structure, course) do
                  %i.lbc-icon-calendar
                  %span Plannings
                  - if course.plannings.empty?
                    %i.fa.fa-times.red
                  - else
                    %i.fa.fa-check.green
          %td.text--center.hard
            .drop-down-el.drop-down__wrapper{data: {behavior: 'drop-down', el: '> .drop-down__el', position: 'right'}}
              %a.btn--orange.btn.btn--small{href: '#'}
                Actions
                %i.fa.fa-chevron-down
                / Actions
              %ul.drop-down__el.text--left
                %li
                  = link_to edit_pro_structure_course_path(@structure, course), title: 'Modifier ce cours', class: 'nowrap' do
                    %i.fa.fa-pencil
                    Modifier le cours
                %li
                  = link_to duplicate_pro_structure_course_path(@structure, course), title: 'Modifier ce cours', class: 'nowrap', method: :post do
                    %i.fa.fa-copy
                    Dupliquer le cours
                %li
                  = link_to  structure_course_path(course.structure, course, subdomain: 'www'), title: 'Voir le cours sur CoursAvenue', target: '_blank', class: 'nowrap' do
                    %i.fa.fa-search
                    Voir sur CoursAvenue
                %li
                  = link_to pro_structure_course_path(@structure, course), class: 'red nowrap', title: 'Supprimer ce cours', data: {confirm: 'Êtes-vous sur de supprimer ce cours ? Cette action sera irreversible.'}, method: :delete do
                    %i.fa.fa-trash-o
                    Supprimer
  - if @courses.disabled.any?
    .grid.push-half--top
      .grid__item.one-half>
        .soft--left.push--left= image_tag 'texts/online-course.png', height: 80
      .grid__item.one-half>
        .soft--right.push--right= image_tag 'texts/plannings.png', height: 62
.text--center.push--top
  = link_to 'Ajouter un cours', new_pro_structure_course_path(@structure), class: 'btn btn--green btn--large'
  %br
  = link_to 'Ajouter un atelier pour les Journées Portes Ouvertes', pro_structure_course_opens_path(@structure)

= content_for :scripts do
  :javascript
    $(function() {
        $('.dataTable').each(function(index, datatable) {
            $(datatable).tablesorter();
        });
        if ($('#understood__course_places')) {
            $('#understood__course_places').click(function() {
                $.cookie('understood__course_places', true, {expires: 100000});
                $('#course-places-info').remove();
            });
        }
    });

- # If a course has just been duplicated, highlights it
- if session[:duplicate] == true
  = content_for :scripts do
    :javascript
      $(function() {
          var duplicate_course = $('[data-id=#{session[:duplicated_course_id]}]');
          setTimeout(function() {
              $(window.document).scrollTo(duplicate_course, {offset: -125, duration: 400});
              setTimeout(function() {
                  duplicate_course.animate({'background-color': '#FFD977'}, {duration: 400}).animate({'background-color': 'transparant'}, {duration: 400});
                  duplicate_course.css('font-weight', 'bold');
              }, 400);
          }, 200);
      });
  - # Delete the session in order that the course doesn't highlight again.
  - session.delete :duplicate
  - session.delete :duplicated_course_id

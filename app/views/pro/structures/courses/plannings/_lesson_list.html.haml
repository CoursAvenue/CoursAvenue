- @plannings.group_by(&:place).each do |place, plannings|
  %hr
  - unless place.nil?
    %h5
      %i.fa.fa-map-marker
      = place.location.name
  %table.table--striped.table--data.white-box#dataTable
    %thead
      %tr
        %th.text--center Jour
        %th.text--center Créneau horaire
        %th.text--center Durée
        %th Professeur
        %th.text--center Niveau
        %th.text--center Public
        %th.text--center Lieu
        %th.text--center
          %i.lbc-icon-info i
        %th
    %tbody
      - plannings.each do |planning|
        %tr{data: {'course-id' => planning.course_id, id: planning.id }}
          %td.text--center{data: {value: planning.week_day}}
            = simple_form_for [:pro, @course, planning], url: pro_structure_course_planning_path(@structure, @course, planning), remote: true do |f|
              - days = t('date.day_names').collect{|day| [day.capitalize, t('date.day_names').index(day)] }.rotate
              = f.input :week_day, as: :select, collection: days, label: false, input_html: {class: 'week-day-select'}, wrapper_html: {class: 'flush'}, include_blank: false
          %td.text--center{data: {value: planning.start_time}}
            = readable_time_slot planning.start_time, planning.end_time
          %td.text--center= readable_duration planning.duration
          %td{data: {value: planning.teacher.try(:name)}}
            = simple_form_for [:pro, @course, planning], url: pro_structure_course_planning_path(@structure, @course, planning), remote: true do |f|
              = f.input :teacher_id, as: :select, collection: @teachers, label: false, input_html: {class: 'teacher-select', style: 'max-width: 10em;'}, wrapper_html: {class: 'flush'}
          %td.text--center= join_levels_text planning
          %td.text--center= join_audiences planning
          %td.text--center{data: {value: (planning.place ? planning.place.location.try(:name) : nil)}}
            = simple_form_for [:pro, @course, planning], url: pro_structure_course_planning_path(@structure, @course, planning), remote: true do |f|
              = f.input :place_id, as: :select, collection: @places, label_method: lambda {|place| place.location.name}, label: false, input_html: {class: 'place-select', style: 'max-width: 15em;'}, wrapper_html: {class: 'flush'}, include_blank: planning.place.nil?
          %td.text--center
            - if planning.info.present?
              .lbc-brand-icon{data: {behavior: 'tooltip', 'original-title' => planning.info}}
          %td.text--center
            .drop-down-el.drop-down__wrapper{data: {behavior: 'drop-down', el: '> .drop-down__el', position: 'right'}}
              %a.btn--orange.btn.btn--small.nowrap{href: '#'}
                Actions
                %i.fa.fa-chevron-down
              %ul.drop-down__el.text--left
                %li
                  = link_to edit_pro_structure_course_planning_path(@structure, @course, planning), title: 'Modifier le créneau', data: {behavior: 'modal', width: '780'}, class: 'fancybox.ajax' do
                    %i.fa.fa-pencil
                    Modifier le créneau
                %li
                  = link_to duplicate_pro_structure_course_planning_path(@structure, @course, planning), title: 'Dupliquer le créneau', class: 'nowrap', method: :post do
                    %i.fa.fa-copy
                    Dupliquer le créneau
                %li
                  = link_to pro_structure_course_planning_path(@structure, @course, planning), method: 'delete', confirm: 'Êtes-vous bien sûr de supprimer ce planning ?', title: 'Supprimer le créneau' do
                    %i.fa.fa-trash-o
                    Supprimer

= content_for :scripts do
  :javascript
    $(function() {
        $('.week-day-select').each(function(index, week_day_select){
            $(this).change(function() {
                week_day_form = $(this).parents('form');
                week_day_form.submit();
                GLOBAL.flash('Le jour a bien été changé');
            })
        });
        $('#dataTable').tablesorter();
    });

= side_menu_currently_at 'contact'

.soft--ends.white-box
  = simple_form_for [:pro, @structure], html: { autocomplete: 'off', id: 'structure-form' } do |form|
    %input{ type: 'hidden', name: 'return_to', value: edit_contact_pro_structure_path(@structure)}

    .soft--sides{ data: { behavior: 'wizard-helper', content: t('pro.structures.wizard_helper.contacts') } }
      %h5 Coordonnées de réservation
      - if @structure.main_contact
        = render "pro/structures/admins/change_email"

      %div{ data: { behavior: 'show-more-on-demand' } }<>
        - @structure.phone_numbers.each_with_index do |phone_number, i|
          = form.simple_fields_for :phone_numbers, phone_number, child_index: i do |phone_number_form|
            %div{ class: (!phone_number_form.object.persisted? ? 'hidden' : ''), data: { el: true, hidden: !phone_number_form.object.persisted? } }<>
              .input.flush--bottom
                %label.control-label.label--large> Téléphone
                .input-container>
                  = phone_number_form.input :number, label: false, input_html: { class: 'input--large one-whole' }, wrapper_html: { class: 'inline-block v-middle flush' }
                  %a.cursor-pointer.v-middle{ href: 'javascript:void(0);', data: { clear: true } }
                    %i.fa.fa-trash-o
                    Supprimer
        .input
          .control-label>
          .input-container>
            %a{ href: 'javascript:void(0)', data: { trigger: true } }>
              %i.fa.fa-plus
              Ajouter un numéro de téléphone

    %hr.push--ends
    .soft--sides
      %h5.flush--bottom.soft--left.push--left Liens vers vos pages

      = form.input :website, label_html: { class: 'label--large' }, input_html: { class: 'input--large' }

      - show_input = @facebook_pages.empty? or (@facebook_pages.any? and @facebook_pages.last[1] == 'other')
      - if @facebook_pages.any?
        = form.input :facebook_url, as: :select, collection: @facebook_pages, wrapper_html: { class: 'flush--bottom' }, label_html: { class: 'label--large' }, input_html: { class: 'input--large', id: 'facebook_select' }
      = form.input :facebook_url, as: :url, wrapper_html: { class: "flush--bottom #{show_input ? '' : 'hidden'}", id: 'facebook_text' }, label_html: { class: 'label--large' }, input_html: { id: 'facebook_text_input', class: 'input--large' }


      .soft--top= form.button :submit, "Enregistrer", class: 'btn btn--green btn--full', data: { disable_with: "En cours d'enregistrement" }

- content_for :scripts do
  :javascript
      var removeNames = function() {
          $('#facebook_select').removeAttr('name');
          $('#facebook_text_input').removeAttr('name');
      }

      $(document).ready(function() {
          var originalName = $('#facebook_select').attr('name');
          removeNames();

          $('#facebook_select').change(function() {
            // Tests if the currently selected option is the last option.
            // This works because `this` is a HTMLSelectElement.
            // See more here <https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement>
            if (this.selectedOptions[0] == this[this.length - 1]) {
                  $('#facebook_text').slideDown();
                  removeNames();

                  $('#facebook_text_input').attr('name', originalName);
              } else {
                  $('#facebook_text').slideUp();
                  removeNames();

                  $('#facebook_select').attr('name', originalName);
              }
          });
          $('#facebook_select').change()
      });

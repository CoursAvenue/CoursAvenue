= side_menu_currently_at 'inscriptions'

.panel
  .panel__header.soft
    %h3.flush Mes inscriptions
  .panel__body.soft--ends
    %table.table--data.table--striped
      %thead
        %tr
          %th Statut
          %th Inscription
          %th Lieu
          %th Jour et horaires
          %th Options
      %tbody
        - @participation_requests.each do |participation_request|
          %tr{ style: ((participation_request.pending? and participation_request.last_modified_by == 'User') ? 'border: 4px solid #e2493c' : '') }
            %td{ class: participation_request_color(participation_request) }
              - if participation_request.pending? and participation_request.last_modified_by == 'User'
                %span.has-tooltip{ data: { toggle: 'popover', content: "Confirmez la demande d'inscription au plus vite", html: 'true', placement: 'top', trigger: 'hover' } }
                En attente
              - else
                = t("participation_request.state.#{participation_request.state}")
            %td
              %strong= participation_request.user.name
              - if participation_request.course.is_open_for_trial?
                pour un essai gratuit :
              - elsif participation_request.course.is_training?
                pour un stage / atelier :
              - else
                pour une 1ère séance :
              - course = participation_request.course
              %span.has-tooltip{ data: { toggle: 'popover', content: "<strong>Niveau :</strong> #{join_levels(participation_request.levels)}<br><strong>Public :</strong> #{join_audiences(participation_request.planning || participation_request.course)}<br><strong>Disciplines :</strong> #{course.subjects.uniq.map(&:name).join(', ')}", html: 'true', placement: 'top', trigger: 'hover' } }
                = course.name

            %td
              - place = participation_request.place
              - if place
                - if place.info.present? or place.private_info.present?
                  %span.has-tooltip{ data: { toggle: 'popover', content: t('places.infos', info: place.info, private_info: place.private_info), html: 'true', placement: 'top', trigger: 'hover' } }
                    = place.name
                - else
                  = place.name
            %td
              = "#{l(participation_request.date, format: :semi_short)} à #{l(participation_request.start_time, format: :short)}"
            %td
              = link_to 'Récapitulatif', pro_structure_participation_request_path(@structure, participation_request)
              .drop-down-el.drop-down__wrapper{ data: { behavior: 'drop-down', el: '> .drop-down__el', position: 'right' } }
                %a.nowrap{ href: '#' }
                  Actions
                  %i.fa.fa-chevron-down
                %ul.drop-down__el.text--left
                  - if !participation_request.canceled? and !participation_request.declined?
                    - if participation_request.pending? and participation_request.last_modified_by == 'User'
                      %li.nowrap= link_to "Accepter l'inscription", accept_pro_structure_participation_request_path(participation_request.structure, participation_request), method: :patch, class: 'green nowrap'

                    %li.nowrap= link_to 'Proposer un autre créneau', edit_pro_structure_participation_request_path(participation_request.structure, participation_request), class: 'orange nowrap fancybox.ajax', data: { behavior: 'modal', width: 800, padding: 0 }
                  - if !participation_request.canceled? and !participation_request.declined?
                    %li.nowrap= link_to "Annuler l'inscription", cancel_form_pro_structure_participation_request_path(participation_request.structure, participation_request), class: 'red nowrap fancybox.ajax', data: { behavior: 'modal', width: 800, padding: 0 }

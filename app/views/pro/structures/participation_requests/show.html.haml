= side_menu_currently_at 'inscriptions'

.panel
  .panel__header.soft
    - if @participation_request.pending? and @participation_request.last_modified_by == 'User' and @participation_request.created_at > 2.days.ago
      .float--right.nowrap.orange.soft-half--top
        %i.fa.fa-clock-o.delta
        %strong.delta Expire dans
        %strong.delta{ data: { 'expires-in' => true } }
    %ol.nav.flush.breadcrumb{ itemprop: 'breadcrumb' }
      %li.gamma.f-weight-500= link_to 'Mes inscriptions', pro_structure_participation_requests_path(@structure)
      %li.gamma.f-weight-500.flush= @user.name

  .panel__body.soft--ends
    = render partial: 'pro/structures/participation_requests/table_recap', locals: { participation_request: @participation_request }

  - user_decorator = @participation_request.user.decorate
  .panel__header.soft.bordered--top
    %h4.flush À propos de l'élève
  .panel__body.soft
    .grid--full.push--bottom.message
      .grid__item.two-twelfths.v-top.v-top>
        - if @participation_request.user.has_avatar?
          = image_tag @participation_request.user.avatar_url(:normal), class: 'center-block push-half--bottom rounded--circle', width: 100
      .grid__item.ten-twelfths.v-top>
        %h4.line-height-1-7.flush= @participation_request.user.name
        %div.line-height-1-7
          Profil : #{user_decorator.age_and_city}
        %div.line-height-1-7
          Email :
          %span.has-tooltip{ data: { toggle: 'popover', content: t('tooltips.pro.participation_requests.infos_will_be_shown_once_accepted'), html: 'true', placement: 'top', trigger: 'hover' } }
            = user_decorator.phone_number(!@participation_request.accepted?)

        %div.line-height-1-7
          Téléphone :
          %span.has-tooltip{ data: { toggle: 'popover', content: t('tooltips.pro.participation_requests.infos_will_be_shown_once_accepted'), html: 'true', placement: 'top', trigger: 'hover' } }
            = user_decorator.email(!@participation_request.accepted?)

    = render partial: 'messages/message', collection: @participation_request.conversation.messages.order('created_at DESC').reject(&:new_record?)


  .panel__header.soft.bordered--top
    - if @participation_request.pending? and @participation_request.last_modified_by == 'User' and @participation_request.created_at > 2.days.ago
      .float--right.nowrap.orange.soft-half--top
        %i.fa.fa-clock-o.delta
        %strong.delta Expire dans
        %strong.delta{ data: { 'expires-in' => true } }
    %h4.flush Acceptez la demande
  .panel__body.soft.bordered--top
    %p
      Vous risquez d'être pénalisé si vous n'acceptez pas ou ne refusez pas cette demande d'inscription avant son expiration :
    .flexbox
      .flexbox__item.nowrap
        Confirmez l'inscription :
      .flexbox__item.one-whole
        = render partial: 'actions'

= content_for :scripts do
  :javascript
    $(function() {
      var date            = Date.parse("#{l(local_time(@participation_request.created_at + 48.hours), format: :js )}");
      var $countdown_div = $('[data-expires-in]');
      countdown(date,
          function(ts) {
              var hours   = ("0" + ts.hours).slice(-2);
              var minutes = ("0" + ts.minutes).slice(-2);
              var seconds = ("0" + ts.seconds).slice(-2);
              $countdown_div.text((ts.days > 0 ? ts.days + ' jours et ' : '') + hours + ':' + minutes + ':' + seconds);
          },
          countdown.DAYS|countdown.HOURS|countdown.MINUTES|countdown.SECONDS);
    });


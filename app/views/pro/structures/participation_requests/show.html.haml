- participation_request_decorator = @participation_request.decorate

- if current_pro_admin
  = side_menu_currently_at 'inscriptions'

- user           = @participation_request.user
- user_decorator = user.decorate
- first_message = @participation_request.conversation.messages.order('created_at DESC').reject(&:new_record?).first

%h1.palm-text--center Demande d'inscription de #{@user.name}
- if @participation_request.accepted?
  .gray-box.rounded.soft.epsilon.push--bottom#pr-confirmation-form
    %h3.push-half--bottom Avez-vous convenu d'une nouvelle date ?
    .delta.line-height-1-7.push-half--bottom
      %strong #{@user.name} assistera à la séance "#{@participation_request.course.name}" le #{participation_request_decorator.day_and_hour(false)}
      %br
      = link_to 'Modifier', edit_pro_structure_participation_request_path(@structure, @participation_request, show_course_select: true), class: 'btn btn--white btn--small fancybox.ajax', data: { behavior: 'modal', width: 500, padding: 0 }
- elsif !@participation_request.canceled?
  .bg-blue-green.rounded.soft.white.epsilon.push--bottom#pr-confirmation-form
    %h3.push-half--bottom Avez-vous convenu d'une date ?
    .delta.line-height-1-7.push-half--bottom
      %strong #{@user.name} assistera à la séance "#{@participation_request.course.name}" le #{participation_request_decorator.day_and_hour(false)}
      %br
      = link_to 'Accepter', accept_pro_structure_participation_request_path(@participation_request.structure, @participation_request), method: :patch, class: 'btn btn--blue-green btn--small'
      = link_to 'Modifier', edit_pro_structure_participation_request_path(@structure, @participation_request, show_course_select: true), class: 'btn btn--white-transparent--orange btn--white-transparent btn--small fancybox.ajax', data: { behavior: 'modal', width: 500, padding: 0 }
      = link_to 'Annuler', cancel_form_pro_structure_participation_request_path(@structure, @participation_request), class: 'btn btn--white-transparent--red btn--white-transparent btn--small fancybox.ajax', data: { behavior: 'modal', width: 500, padding: 0 }
    .line-height-1-5
      PS : en confirmant la date, nous enverrons à l'inscrit un SMS de rappel 1 jour avant le cours et il recevra une demande de recommandation le lendemain. Ainsi, vous limitez le nombre d'absents et votre bouche-à-oreille augmente.

.grid--full.push--bottom.message
  .grid__item.palm-one-whole.palm-block.palm-text--center.two-twelfths.v-top.v-top>
    = image_tag user.avatar_url(:normal), class: 'center-block push-half--bottom rounded--circle', width: 100
    .text--center
      = "#{l(local_time(first_message.created_at).to_date, format: :short)} à #{l(local_time(first_message.created_at), format: :short)}"
  .grid__item.palm-one-whole.palm-block.palm-text--center.ten-twelfths.v-top>
    .delta.line-height-1-7.flush
      = "#{user.name}, #{user_decorator.age_and_city}"
    - if !@participation_request.pending?
      - if user.phone_number.present?
        %div.line-height-1-7.delta
          %i.fa.fa-phone-o
          = user_decorator.phone_number
      %div.line-height-1-7.delta
        %i.fa.fa-envelope-o
        = link_to user_decorator.email, "mailto:#{user_decorator.email}"

    - if user.description.present?
      %div.line-height-1-7.quoted.epsilon.push-half--bottom
        %i= user.description
    .message__body.soft-half.gray-box.message__appendix
      .epsilon.line-height-1-5
        = "#{@participation_request.course.name}, le "
        %strong= "#{participation_request_decorator.day_and_hour(false)},"
        = participation_request_decorator.details
      %hr.push-half--ends
      = simple_format first_message.body

-# Because this page can be accesed throught bitly as non connected user.
- if current_pro_admin
  = content_for :top_menu do
    .flexbox
      .flexbox__item.v-middle
        %ol.nav.flush.breadcrumb{ itemprop: 'breadcrumb' }
          %li.active-without-caret= link_to 'Mes inscriptions', pro_structure_participation_requests_path(@structure), class: 'semi-muted-link epsilon f-weight-600 soft--left soft-half--ends white'
          %li.epsilon.f-weight-500.white.soft-half--ends= @user.name

.push--bottom
  = render partial: 'pro/structures/participation_requests/table_recap', locals: { participation_request: @participation_request }

%h3 Discussion avec #{@user.name}
= render partial: 'pro/structures/conversations/form', locals: { conversation: @participation_request.conversation }
= render partial: 'messages/message', collection: @participation_request.conversation.messages.order('created_at DESC').reject(&:new_record?)

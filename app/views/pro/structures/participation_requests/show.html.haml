= side_menu_currently_at 'inscriptions'

.panel
  .panel__header.soft
    - if @participation_request.pending? and @participation_request.last_modified_by == 'User' and @participation_request.created_at > 2.days.ago
      .float--right.nowrap.orange.soft-half--top
        %i.fa.fa-clock-o.delta
        %strong.delta Expire dans
        %strong.delta#expires-in
    %ol.nav.flush.breadcrumb{ itemprop: 'breadcrumb' }
      %li.gamma.f-weight-500= link_to 'Mes inscriptions', pro_structure_participation_requests_path(@structure)
      %li.gamma.f-weight-500.flush= @user.name
  .panel__body.soft--ends
    .flexbox.soft--sides
      - if !@participation_request.canceled? and !@participation_request.declined?
        - if @participation_request.pending? and @participation_request.last_modified_by == 'User'
          .flexbox__item.one-third>
            = link_to accept_pro_structure_participation_request_path(@participation_request.structure, @participation_request), method: :patch, class: 'btn--full btn--green btn' do
              Accepter l'inscription

        .flexbox__item.one-third.soft-half--sides>
          = link_to edit_pro_structure_participation_request_path(@participation_request.structure, @participation_request), class: 'btn--full btn--orange nowrap btn fancybox.ajax', data: { behavior: 'modal', width: 800, padding: 0 } do
            Proposer un autre crÃ©neau
      - if !@participation_request.canceled? and !@participation_request.declined?
        .flexbox__item.one-third>
          = link_to cancel_form_pro_structure_participation_request_path(@participation_request.structure, @participation_request), class: 'btn--full btn--red btn fancybox.ajax', data: { behavior: 'modal', width: 800, padding: 0 } do
            Annuler l'inscription
    %hr.push--top.flush--bottom
    = render partial: 'pro/structures/participation_requests/table_recap', locals: { participation_request: @participation_request }

  .panel__header.soft.bordered--top
    %h4.flush Historique des messages
  .panel__body.soft
    - if @participation_request.pending? and @participation_request.last_modified_by == 'Structure'
      = render partial: 'pro/structures/conversations/participation_request_form', locals: { participation_request: @participation_request, return_to: pro_structure_participation_request_path(@structure, @participation_request) }
    - else
      = render partial: 'pro/structures/conversations/form', locals: { conversation: @participation_request.conversation, return_to: pro_structure_participation_request_path(@structure, @participation_request) }
    = render partial: 'messages/message', collection: @participation_request.conversation.messages.order('created_at DESC').reject(&:new_record?)


= content_for :scripts do
  :javascript
    $(function() {
      var date            = Date.parse("#{l(local_time(@participation_request.created_at + 48.hours), format: :js )}");
      var $countdown_div = $('#expires-in');
      countdown(date,
          function(ts) {
              var hours   = ("0" + ts.hours).slice(-2);
              var minutes = ("0" + ts.minutes).slice(-2);
              var seconds = ("0" + ts.seconds).slice(-2);
              $countdown_div.text((ts.days > 0 ? ts.days + ' jours et ' : '') + hours + ':' + minutes + ':' + seconds);
          },
          countdown.DAYS|countdown.HOURS|countdown.MINUTES|countdown.SECONDS);
    });


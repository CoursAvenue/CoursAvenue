= side_menu_currently_at 'places'

.panel
  .panel__body
    - if @places.any?
      #map.google-map.push--top
    .text--center.push
      = link_to 'Ajouter un nouveau lieu', new_pro_structure_place_path(@structure), class: 'btn btn--green btn--large'

    - if @places.any?
      %table.table--striped
        %thead
          %tr
            %th.hard--right{style: 'width: 2em;'}
              %i.fa.fa-external-link
            %th Nom du lieu
            %th Adresse
            %th
        %tbody
          - @places.each do |place|
            %tr
              %td.hard--right
                = link_to place_url(place, subdomain: 'www'), title: 'Voir la fiche établissement sur CoursAvenue', target: '_blank' do
                  %i.fa.fa-external-link
              %td
                - if current_pro_admin
                  = link_to place.location.name, edit_pro_structure_place_path(@structure, place)
                - else
                  = link_to place.location.name, place_url(place, subdomain: 'www')
              %td= place.location.address
              %td.text--right.nowrap
                = link_to edit_pro_structure_place_path(@structure, place), title: 'Modifier ce lieu', class: 'btn btn--orange btn--small' do
                  %i.fa.fa-pencil
                  %span.soft-half--left Modifier ce lieu
                &nbsp;
                - if place.plannings.any?
                  - delete_alert = 'Des crénaux sont associés à ce lieu et seront SUPPRIMÉS si supprimez ce lieu. Êtes-vous sur de vouloir faire cette action ? Cette action sera IRREVERSIBLE.'
                - else
                  - delete_alert = 'Êtes-vous sur de supprimer ce lieu ? Cette action sera IRREVERSIBLE.'
                = link_to pro_structure_place_path(@structure, place), method: :delete, data: {confirm: delete_alert}, title: 'Supprimer ce lieu', class: 'btn btn--red btn--small' do
                  %i.fa.fa-trash-o

= content_for :scripts do
  :javascript
    $(function() {
        google_map_handler = Gmaps.build('Google', { markers: { maxRandomDistance: null } });
        google_map_handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
            var markers = google_map_handler.addMarkers(#{@locations.to_json});
            google_map_handler.bounds.extendWith(markers);
            google_map_handler.fitMapToBounds();
            if (google_map_handler.getMap().getZoom() > 15) {
              google_map_handler.getMap().setZoom(15);
            }
        });
    });

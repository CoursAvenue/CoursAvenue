= side_menu_currently_at 'places'

.panel
  .panel__header.soft.text--center
    = link_to 'Ajouter un nouveau lieu', new_pro_structure_place_path(@structure, type: 'Place::Public'), class: 'btn btn--green btn--large fancybox.ajax', data: { behavior: 'modal', width: '650', padding: 0 }
    .text--center
      #new-home-place{ class: (@places.homes.empty? ? '' : 'hidden') }
        = link_to 'Ajouter la zone géographique pour mes cours à domicile', new_pro_structure_place_path(@structure, type: 'Place::Home'), class: 'fancybox.ajax', data: { behavior: 'modal', width: '650', padding: 0 }
      #update-home-place{ class: (@places.homes.empty? ? 'hidden' : '') }
        = link_to 'Modifier la zone géographique pour mes cours à domicile', edit_pro_structure_place_path(@structure, (@places.homes.first ? @places.homes.first : '__HOME_PLACE_ID__')), class: 'fancybox.ajax', data: { behavior: 'modal', width: '650', padding: 0 }
  .panel__body{ data: { behavior: 'wizard-helper', content: t('pro.places.wizard_helper.index') } }
    #map.google-map.push--bottom{ class: (@places.any? ? '' : 'hidden')}

    %table.table--striped.flush#place-table{ class: (@places.any? ? '' : 'hidden')}
      %thead
        %tr
          %th.four-twelfths Nom du lieu
          %th.four-twelfths Adresse
          %th.one-twelfths
          %th.three-twelfths
      %tbody
        - @places.each do |place|
          = render partial: 'pro/structures/places/place', locals: { place: place, structure: @structure}

- if current_pro_admin.email == 'nima@coursavenue.com'
  :javascript
    alert('TODO: add marker when we create or update a place');

= content_for :scripts do
  :javascript
    $(function() {
        google_map_handler = Gmaps.build('Google', { markers: { maxRandomDistance: null } });
        google_map_handler.buildMap({ provider: { scrollwheel: false }, internal: { id: 'map' }}, function(){
            var markers = google_map_handler.addMarkers(#{@place_coordinates.to_json});
            google_map_handler.bounds.extendWith(markers);
            google_map_handler.fitMapToBounds();
            if (google_map_handler.getMap().getZoom() > 15) {
                google_map_handler.getMap().setZoom(15);
            }
        });
    });

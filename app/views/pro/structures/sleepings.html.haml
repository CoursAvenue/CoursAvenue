= side_menu_currently_at 'sleepers'

= content_for :top_menu do
  %ul.nav.flush
    %li{ class: params[:opt_in] == 'true' ? 'active' : '' }
      = link_to sleepings_pro_structures_path(opt_in: true), class: 'muted-link epsilon f-weight-600 soft--sides soft-half--ends' do
        En attente de validation
    %li{ class: params[:opt_in] == 'false' ? 'active' : '' }
      = link_to sleepings_pro_structures_path(opt_in: false), class: 'muted-link epsilon f-weight-600 soft--sides soft-half--ends' do
        Desinscription

%table.table--striped.table--data#dataTable
  %thead
    %tr
      %th
        %span Nom
      %th.sortAsc
        %span Date de création
      %th Activé son profil
      %th
      %th Profil
  %tbody
    - @structures.each do |structure|
      - next unless structure.is_sleeping
      %tr
        %td
          = link_to structure.name, dashboard_pro_structure_path(structure)
        %td
          = l(structure.main_contact.created_at.to_date) if structure.main_contact
        %td
          - if structure.main_contact and structure.main_contact.confirmed?
            %i.fa.fa-check.green
          - else
            %i.fa.fa-times.red
        %td.nowrap
          = link_to 'Public', structure_url(structure, subdomain: CoursAvenue::Application::WWW_SUBDOMAIN)
          \/
          = link_to 'Privé', pro_structure_path(structure)
          \/
          = link_to "Lien d'inscription", new_pro_admin_structure_registration_path(structure)
          - if params[:opt_in] == 'false'
            = link_to 'Supprimer mon compte', ask_for_deletion_pro_structure_path(structure), class: 'red fancybox.ajax', data: { behavior: 'modal', padding: '0', width: 800 }
        %td
          - if params[:opt_in] == 'false'
            = structure.sleeping_email_opt_out_reason
          - elsif structure.main_contact
            = link_to 'Valider', wake_up_pro_structure_path(structure), method: :patch, class: 'btn btn--small btn--green'
            = link_to 'Rollback', return_to_sleeping_mode_pro_structure_path(structure), method: :patch, class: 'btn btn--small btn--red', data: { confirm: 'Êtes-vous sûr de vouloir rollback cette structure ?' }
.text--center.push-half--ends= paginate @structures, window: 1, outer_window: 3

= side_menu_currently_at 'sleepers'
.panel
  %ul.tabs.flush.panel__header
    %li{ class: params[:opt_in] == 'true' ? 'active' : '' }
      = link_to sleepings_pro_structures_path(opt_in: true) do
        En attente de validation
    %li{ class: params[:opt_in] == 'false' ? 'active' : '' }
      = link_to sleepings_pro_structures_path(opt_in: false) do
        Desinscription

  .panel__body.soft--ends
    %table.white-box.table--striped.table--data#dataTable
      %thead
        %tr
          %th
            %span Nom
          %th.sortAsc
            %span Date de création
          %th
          %th Profil
      %tbody
        - @structures.each do |structure|
          %tr
            %td
              = link_to structure.name, dashboard_pro_structure_path(structure)
            %td{data: {value: structure.created_at}}
              = l(structure.created_at.to_date)
            %td.nowrap
              = link_to 'Public', structure_url(structure, subdomain: CoursAvenue::Application::WWW_SUBDOMAIN)
              \/
              = link_to 'Privé', pro_structure_path(structure)
              \/
              = link_to "Lien d'inscription", new_pro_admin_structure_registration_path(structure)
            %td
              - if params[:opt_in] == 'false'
                = structure.sleeping_email_opt_out_reason
              - elsif structure.main_contact
                = link_to 'Valider', wake_up_pro_structure_path(structure), method: :patch, class: 'btn btn--small btn--green'
                = link_to 'Rollback', return_to_sleeping_mode_pro_structure_path(structure), method: :patch, class: 'btn btn--small btn--red', data: { confirm: 'Êtes-vous sûr de vouloir rollback cette structure ?' }
    .text--center.push-half--ends= paginate @structures, window: 1, outer_window: 3
= content_for :scripts do
  :javascript
    $(function() {
        $('#dataTable').tablesorter();
    });

= side_menu_currently_at 'statistics'
.panel
  .panel__body.soft--ends.relative
    = image_tag 'icons/premium-ribbon.png', class: 'north west absolute on-top', height: 80, width: 80, style: 'width: 80px; height: 80px;'
    .soft--sides{ data: { behavior: 'wizard-helper', content: t('statistics.wizard.infos') } }
      %h4.text--center Statistiques de votre annonce pour les 15 derniers jours
      .grid.push--bottom
        .grid__item.one-third.text--center>
          .inline-block.pointer{ data: { behavior: 'toggle-serie' } }
            .lbl.lbl--chip.lbl--red.v-middle.lbl--small
            %h5.flush.v-middle.inline-block
              - if @structure.premium?
                = "#{pluralize(@impressions_total_count, 'Affichage')}"
              - else
                XX Affichages
        .grid__item.one-third.text--center>
          .inline-block.pointer{ data: { behavior: 'toggle-serie' } }
            .lbl.lbl--chip.lbl--blue.v-middle.lbl--small
            %h5.flush.v-middle.inline-block
              - if @structure.premium?
                = "#{pluralize(@views_total_count, 'Vue')}"
              - else
                XX Vues
        .grid__item.one-third.text--center>
          .inline-block.pointer{ data: { behavior: 'toggle-serie' } }
            .lbl.lbl--chip.lbl--green.v-middle.lbl--small
            %h5.flush.v-middle.inline-block
              - if @structure.premium?
                = "#{pluralize(@actions_total_count, 'Action')}"
              - else
                XX Actions

      #statistics

    %hr.push--sides

    .soft--sides{ data: { behavior: 'wizard-helper', content: t('statistics.wizard.advices') } }
      %h4 Conseils personnalisés
      .text--center.push--bottom
        = link_to '10 conseils personnalisés pour optimiser votre communication et vos statistiques', '#', class: 'btn btn--yellow'
      %p.epsilon Bénéficiez de conseils en marketing et en communication que vous pouvez également appliquer sur tous vos supports de communication (site Internet, newsletters, affiches, etc.)

= content_for :scripts do
  :javascript
    $(function() {
        var statistic_chart = new Highcharts.Chart({
            chart: { renderTo: 'statistics', type: 'column' },
            title: { text: null },
            xAxis: {
                categories: #{((Date.today - 30.days)..Date.today).map{|date| l(Date.parse(date.to_s), format: :short)}},
                showEmpty: true
            },
            yAxis: {
                title: { text: ''},
                showEmpty: true,
                minTickInterval: 1
            },
            colors: ['#e2493c', '#00B0FF', '#47b442'],
            plotOptions: {
                series: {
                    pointPadding: 0,
                    groupPadding: 0.1,
                    borderWidth: 0,
                    shadow: false
                }
            },
            series: [
              { data: #{@impressions.sort.map{|date, count| count}},
                name: 'Affichages'
               },
              { data: #{@views.sort.map{|date, count| count}},
                name: 'Vues'
              },
              { data: #{@actions.sort.map{|date, count| count}},
                name: 'Actions'
              }
            ]
        });
        $("[data-behavior='toggle-serie']").each(function(index) {
            var serie = statistic_chart.series[index];
            $(this).click(function() {
                if (serie.visible) {
                    $(this).addClass('muted');
                    serie.hide();
                } else {
                    $(this).removeClass('muted');
                    serie.show();
                }
            });
        });
    });

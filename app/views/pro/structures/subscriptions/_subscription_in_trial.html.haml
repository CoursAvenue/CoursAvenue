%p.epsilon
  Votre abonnement <strong>#{@subscription.plan.public_name}</strong> est en periode d'essai. Vous pouvez vous abonner ci-dessous, dans l'espace « Gestion de votre abonnement ».

%hr.push--ends
%h3 Historique des factures
= link_to "Voir l'historique des factures.", pro_structure_invoices_path(@structure)

%hr.push--ends
%h3 Gestion de votre abonnement
%p
  = link_to 'Activer mon abonnement', 'javascript:void(0)', data: { stripe: true, amount: @subscription.plan.amount }, class: 'btn btn--green'
  -# = link_to 'Activer mon abonnement', stripe_payment_form_pro_structure_subscription_path(@structure, @subscription), data: { stripe: true, amount: @subscription.plan.amount }, class: 'btn btn--green fancybox.ajax',  data: { behavior: 'modal', width: '300', padding: 0 }

  = link_to 'Résilier mon abonnement', cancel_pro_structure_subscription_path(@structure, @subscription), class: 'red fancybox.ajax',  data: { behavior: 'modal', width: '600', padding: 0 }

= simple_form_for [:pro, @structure, @subscription], url: activate_pro_structure_subscription_path(@structure, @subscription), html: { id: 'subscription_form' } do |f|
  = f.input :stripe_token, as: :hidden

- content_for :scripts do
  = javascript_include_tag '//checkout.stripe.com/checkout.js'

  :javascript
    $(document).ready(function() {
      var stripeHandler = StripeCheckout.configure({
          key: "#{ Rails.configuration.stripe[:publishable_key] }",
          token: function(token) {
              $('[name="subscription[stripe_token]"]').val(token.id);
              $('#subscription_form').submit();
          },
      });
      $('[data-stripe]').click(function(event) {

          event.preventDefault();

          stripeHandler.open({
              email: "#{@structure.contact_email}",
              name: 'CoursAvenue',
              panelLabel: 'Payer {{amount}}',
              //image: '#{asset_path('logos/coursavenue_2_lignes.png')}',
              image: 'http://coursavenue-public.s3.amazonaws.com/logos/logo_stripe.jpg',
              description: 'Abonnement #{@subscription.plan.public_name}',
              currency: "#{Subscription::CURRENCY}",
              amount: parseInt($(this).data('amount'), 10) * 100
          });
      });
    });

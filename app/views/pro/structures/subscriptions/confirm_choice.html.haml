- token = params[:sponsorship_token] || @sponsorship_token

- if @plan.website_plan?
  = render partial: 'pro/subscriptions/plans/pro_plus_confirm', locals: { plan: @plan, sponsorship_token: token }
- else
  = render partial: 'pro/subscriptions/plans/pro_confirm', locals: { plan: @plan, sponsorship_token: token }

- if @structure.subscription
  - @subscription = @structure.subscription
  = simple_form_for [:pro, @structure, @subscription], url: activate_pro_structure_subscription_path(@structure, @subscription), html: { id: 'subscription_form' } do |f|
    = f.input :stripe_token, as: :hidden
    = f.input :sponsorship_token, as: :hidden
    %input{ type: 'hidden', name: 'plan_id' }

  :javascript
    var stripeHandler = StripeCheckout.configure({
        key: "#{ Rails.configuration.stripe[:publishable_key] }",
        token: function token(token) {
            var sponsorship_token = $('#sponsorship_token').val();
            $('[name="subscription[sponsorship_token]"]').val(sponsorship_token);

            $('[name="subscription[stripe_token]"]').val(token.id);
            $('#subscription_form').submit();
            CoursAvenue.showFullPageLoader('Activation en cours...');
        },
    });
    $('[data-stripe]').click(function(event) {
        $('[name=plan_id]').val($(this).data('plan-id'));

        event.preventDefault();

        stripeHandler.open({
            email: "#{@structure.contact_email}",
            name: 'CoursAvenue',
            panelLabel: 'Payer {{amount}}',
            image: 'http://coursavenue-public.s3.amazonaws.com/logos/logo_stripe.jpg',
            description: 'Abonnement #{@subscription.plan.public_name}',
            currency: "#{Subscription::CURRENCY}",
            amount: parseInt($(this).data('amount'), 10) * 100
        });
    });

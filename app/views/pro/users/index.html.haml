= side_menu_currently_at 'Users'

%h2 Liste des utilisateurs (#{User.count})

.text--center
  = link_to 'Avec avis', pro_users_path(with_comments: true), class: 'btn btn--blue'

%table.table--striped.white-box#dataTable
  %thead
    %tr
      %th
      %th
        %span Nom
      %th
        %span Date d'inscription
      %th
        %span Derni√®re date de connexion
      %th.text--center
        %span Facebook
      - if params[:with_comments]
        %th.text--center
          %span Dernier avis
  %tbody
    - @users.each do |user|
      %tr
        %td.text--center
          - if user and user.has_avatar?
            = image_tag user.avatar_url(:small), height: 60
          - elsif user.name.present?
            = image_tag 'icons/avatar.png', height: 60
        %td
          = user.name
          = link_to "(#{user.email})", "mailto:#{user.email}"
        %td{data: {value: user.last_sign_in_at}}
          = l(user.last_sign_in_at) if user.last_sign_in_at
        %td{data: {value: user.last_sign_in_at}}
          = l(user.last_sign_in_at) if user.last_sign_in_at
        %td.text--center{data: {value: (user.provider == 'facebook' ? 'f' : '')}}
          - if user.provider == 'facebook'
            %i.fa.fa-check
        - if params[:with_comments]
          %td{data: {value: user.created_at}}
            - comment = user.comments.last
            - if comment
              = link_to "Voir l'avis", structure_url(comment.structure, anchor: "recommandation-#{comment.id}", subdomain: 'www')

= content_for :scripts do
  :javascript
    $(function() {
        $('#dataTable').tablesorter();
    });

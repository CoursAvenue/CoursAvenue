- default_fake_message = []
- default_fake_message << "Salut !\nJe viens de déposer ma recommandation, j'espère qu'elle te plaira.\nMerci pour tout, à très bientôt !"
- default_fake_message << "Bonjour,\nJ’ai déposé mon témoignage avec grand plaisir, ça fait toujours du bien de partager de si belles expériences.\nA très vite !"
- default_fake_message << "Salut,\nMerci beaucoup d’avoir pensé à moi pour témoigner sur tes cours que je recommande toujours aussi vivement !\nA très vite."
- default_fake_message << "Salut\nSuperbe idée que de témoigner sur tes cours qui m’apportent toujours autant.\nA très bientôt !"
- default_fake_message << "Hello,\nMon avis vient d’être posté sur ton profil, bien content de participer au bouche à oreille.\nMerci, à bientôt !"
- default_fake_message << "Salut,\nRavi d’avoir pu poster ma recommandation sur tes cours qui valent la peine d’être connus.\nA + !"
- default_fake_message << "Salut,\nMa recommandation est déposée, j’espère qu’elle t’aidera à développer encore plus de cours.\nÀ très vite !"
- default_fake_message << "Hello,\nVoici mon avis positif à propos de tes cours, à très bientôt dans une prochaine séance !"
- default_fake_message << "Salut,\nSuite à ta demande de recommandation, voici mon avis à propos de tes cours, toujours au top.\nA bientôt !"
- default_fake_message << "Salut,\nC’était très facile de rédiger mon avis positif à propos de tes cours ! Merci encore et à très bientôt."
- default_fake_message << "Hello,\nVoici mon témoignage sur tes cours, j’ai déjà hâte de venir à la prochaine séance !"
- default_fake_message << "Bonjour,\nJ'ai déposé mon avis qui est bien sûr très positif.\nBises et à très bientôt !"
- default_fake_message << "Salut !\nJ'espère que mon avis te plaira.\nÀ très vite !"
- default_fake_message << "Salut !\nVoilà, j'ai déposé mon avis.\nMerci d'avoir pensé à moi, à bientôt !"

= content_for :title do
  = "À tous nos élèves : recommandez-nous sur CoursAvenue !"

= content_for :meta_description do
  = "Merci d'avance pour tous vos témoignages."

- if params.has_key? :stage
  = content_for :scripts do
    :javascript
      $(function() {
        if(typeof _gaq !== 'undefined') {_gaq.push(['_trackEvent', 'Commentaire j+', 'vue', '#{params[:stage]}']);}
      });
- else
  = content_for :scripts do
    :javascript
      $(function() {
        if(typeof _gaq !== 'undefined') {_gaq.push(['_trackEvent', 'Commentaire j+', 'vue', '0']);}
      });

- if params.has_key? :facebook
  = content_for :scripts do
    :javascript
      $(function() {
        if(typeof _gaq !== 'undefined') {_gaq.push(['_trackEvent', 'Commentaire depuis facebook', 'vue', '#{@structure.name}']);}
      });

- if params.has_key? :website
  = content_for :scripts do
    :javascript
      $(function() {
        if(typeof _gaq !== 'undefined') {_gaq.push(['_trackEvent', 'Commentaire depuis site perso', 'vue', '#{@structure.name}']);}
      });

- if params.has_key? :email
  = content_for :scripts do
    :javascript
      $(function() {
        if(typeof _gaq !== 'undefined') {_gaq.push(['_trackEvent', 'Commentaire depuis email perso', 'vue', '#{@structure.name}']);}
      });

.grid
  .grid__item.two-thirds>
    .grid
      .grid__item.one-eighth>
        = image_tag @structure.logo.url(:thumb)
      .grid__item.seven-eighths>
        %h2.flush--bottom.small-margin-bottom= @structure.name
        %h4 Votre expérience est précieuse pour les autres élèves. Merci !
    .islet.white-box.two-thrids.center-block
      = simple_form_for @comment, url: comments_path do |f|
        = f.error_notification
        %input{type: :hidden, name: 'from', value: 'recommendation-page'}
        = f.hidden_field :commentable_type
        = f.hidden_field :commentable_id
        - if @comment.errors.any?
          %br
          %p.alert.alert-error
            - @comment.errors.full_messages.each_with_index do |message, index|
              - if index != 0
                %br
              = message

        .input
          %label.control-label
            .lbl.lbl--blue
              %i.fa.fa-eye.soft-half--right
              Public
          %h5.inline
            Déposez votre avis visible de tous
        = f.input :course_name, label_html: {class: 'v-middle', style: 'vertical-align: top;'}, wrapper_html: {class: 'flush--bottom'}, placeholder: 'Ex. : Stage de danse jazz new style pour ado du jeudi soir'
        = f.input :title, label_html: {class: 'v-middle', style: 'vertical-align: top;'}, wrapper_html: {class: 'flush--bottom'}, placeholder: "Ex. : Un professeur toujours à l'écoute"

        .input.flush--bottom<
          = f.label :content, style: 'vertical-align: top;'
          = f.input :content, label: false, input_html: {style: 'height: 150px;', class: 'one-whole', data: { behavior: 'text-counter', 'average-words-nb' => Comment::MIN_LENGTH, 'good-words-nb' => 60, 'bad-text' => "Votre avis doit comporter au moins #{Comment::MIN_LENGTH} mots.", 'average-text' => 'Encore quelques mots et votre professeur sera enchanté !', 'good-text' => "Là c'est certain, votre professeur va adorer !"}}, wrapper_html: { class: 'flush' }, required: true
        %p.field-form-info.flush
          = link_to 'Astuces pour un avis utile', '#', id: 'show_comments_trick'
        - unless current_user
          = f.input :author_name, label_html: {style: 'vertical-align: top;', class: 'v-middle'}, required: true, placeholder: 'Ex. : Stéphanie P.'
        %hr.push--top
        .input
          %label.control-label
            .lbl.lbl--gray
              %i.fa.fa-lock.soft-half--right
              Privé
          %h5.inline
            Informations visibles uniquement par votre professeur
        - unless current_user
          = f.input :email, label_html: {style: 'vertical-align: top;', class: 'v-middle'}, required: true, placeholder: "Votre email ne sera visible que par votre professeur", input_html: { value: (params[:comment].present? ? params[:comment][:email] : params[:email])}
        .input.push-half--bottom
          %label.control-label.text>
            %strong Message personnel
        .input
          %label.control-label.text> Objet
          = text_field_tag :subject, params[:subject], placeholder: "Ex. : Merci d'avoir pensé à moi !"
        .input
          %label.control-label.text> Message
          = text_area_tag :private_message, (params[:private_message] || default_fake_message.sample), class: 'text', style: 'height: 100px', data: { behavior: 'autoresize' }
        .text--center
          = f.submit 'Publier mon avis', class: 'btn btn--large btn--green', style: 'padding-top: 6px; padding-bottom: 6px;'

  .grid__item.one-third>
    #comment_tricks.hidden
      .alert--info
        %b Astuces pour un avis utile.
        %p.flush Rédigez votre avis en répondant aux questions suivantes :
        %ul
          %li Depuis quand suivez-vous ce cours ? / Quand avez-vous suivi ce stage ?
          %li Quelle est la principale qualité du professeur ?
          %li Qu’est-ce qui rend ce cours différent des autres ?
          %li Qu’est-ce que vous avez tiré de ce cours ou de ce stage ? Quels en sont les bénéfices (mieux dans mon corps, moins stressé(e), etc.) ?
          %li Concrètement, qu’est-ce que vous faites aujourd’hui grâce à ce que vous avez appris ?
          %li Comment vous êtes-vous senti(e) à la fin du dernier cours ou stage ?
          %li Racontez une anecdote sympa à partager aux futurs élèves !
    .bordered--left.soft--left
      - if @comments.any?
        %h4 Derniers avis sur cet établissement
        %ul.comment-list.milli
          = render partial: 'comments/comment', collection: @comments, locals: {small_avatar: true}
      - else
        %h4 Derniers avis sur CoursAvenue
        %ul.comment-list.milli
          = render partial: 'comments/comment', collection: Comment.accepted.limit(4), locals: {small_avatar: true}


= content_for :scripts do
  :javascript
    $(function() {
        $('#comment_content').textareaResizer();
        $('#show_comments_trick').click(function() {
            $('#comment_tricks').slideToggle();
        });
    });

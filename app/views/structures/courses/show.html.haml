- if @course.image
  = content_for :meta_image do
    = @course.image.url

= content_for :title do
  = "#{@course.type_name} de #{@course.name} avec #{@structure.name}"

= content_for :meta_description do
  - if @course.description.present?
    = "#{@course.description_for_meta} - #{@course.name} à #{@structure.name}"
  - else
    - if @course.has_teacher?
      = "Réservez le #{@course.type_name.downcase} de #{@course.name} par #{join_teachers(@course)}. Retrouvez tous les avis et infos sur ce #{@course.type_name.downcase} - #{@course.name} à #{@structure.name}"
    - else
      = "Réservez le #{@course.type_name.downcase} de #{@course.name}. Retrouvez tous les avis et infos sur ce #{@course.type_name.downcase} - #{@course.name} à #{@structure.name}"

.inline-block
  - if cookies[:search_path]
    = link_to cookies[:search_path] do
      %i.orange ←
      = t('.back_to_results')
  - else
    = link_to courses_path do
      %i.orange ←
      = t('.see_arrounding_courses')
.inline-block.push-half--sides
  |
.inline-block
  %ol.nav.breadcrumb.flush{itemprop: 'breadcrumb'}
    %li
      = link_to "Tous les cours", courses_path
    %li
      = link_to @structure.name, structure_path(@structure), onclick: "_gaq.push(['_trackEvent', 'Voir l établissement', 'click','#{@course.slug}'])"
    %li.course-title= @course.name


.grid.push--top
  .grid__item.six-tenths>
    %ul.tabs
      %li.active
        %a{href: '#tab-map', data: {toggle: 'tab'} }
          %i.icon-map-marker
          Carte
      %li
        %a{href: '#tab-medias', data: {toggle: 'tab'} }
          %i.icon-picture
          Photos & Vidéos
          - if @medias.any?
            = "(#{@medias.length})"

    .tab-content
      #tab-map.tab-pane.active
        .course-header-map>
          = gmaps( {markers: {data: @json_place_address}, map_options: {maxZoom: 17, mapTypeControl: false}} )
        %ul.block-list.white-box#place-list
          - @course.places.each_with_index do |place, index|
            %li.grid--full.hidden
              .grid__item.width-auto.v-middle.soft-half--right>
                .map-marker-image.center-block
                  %a
                    %span= index + 1
              .grid__item.seven-eighths.v-middle>
                = place.location.name
                %br
                %i= place.location.address
              %div{itemscope: true, itemtype: 'http://schema.org/Place'}
                .visuallyhidden{itemprop: 'geo', itemscope: true, itemtype: 'http://schema.org/GeoCoordinates'}
                  %meta{itemprop: 'latitude', content: place.location.latitude}
                  %meta{itemprop: 'longitude', content: place.location.longitude}
          .text--center
            %a#show-all-places{href: 'javascript:void(0)'} Voir les adresses

      %article#tab-medias.tab-pane
        - if @medias.any?
          .media-gallery
            = render partial: 'medias/media', collection: @medias
        - else
          %p.white-box.islet
            Aucun média n'a été ajouté


    %ul.tabs
      %li.active
        %a{class: (@course.plannings.any? ? '' : 'gray-light'), href: '#tab-planning', data: {toggle: 'tab'} }
          %i.icon-calendar
          Planning & Tarifs
      %li#description_tab
        %a{class: (@course.description.present? ? '' : 'gray-light'), onclick: "_gaq.push(['_trackEvent', 'Description cours', 'click', '#{@course.slug}'])", href: '#tab-description', data: {toggle: 'tab'} }
          %i.icon-list
          Description
      %li#comment_tab
        %a{class: (@course.comments.any? ? '' : 'gray-light'), onclick: "_gaq.push(['_trackEvent', 'Avis', 'click', '#{@course.slug}'])", href: '#tab-comments', data: {toggle: 'tab'} }
          %i.icon-comments
          Avis
      %li
        %a{class: (@course.teachers.any? ? '' : 'gray-light'), onclick: "_gaq.push(['_trackEvent', 'Infos profs', 'click', '#{@course.slug}'])", href: '#tab-teacher', data: {toggle: 'tab'} }
          %i.icon-group
          = Teacher.model_name.human(count: @course.teachers.uniq.length)

    .tab-content
      = render 'planning_tab'
      -# = render 'price_tab'
      %article#tab-description.tab-pane
        .white-box.islet
          %h2.delta Description du #{@course.type_name.downcase.html_safe} de : #{@course.name}
          - if @course.description
            %p= @course.description.html_safe
          - else
            %p Pas de description

      = render 'teacher_tab'

      %article#comments#tab-comments.tab-pane
        - if @comments.empty?
          %p.white-box.islet.text--center
            Cet établissement n'a pas encore d'avis
            %br
            %b Soyez le premier à nous donner votre avis !
        - if @comments.any?
          #comments
            - @comments.each_with_index do |comment, index|
              = render partial: 'comments/comment', locals: {comment: comment, show_title: true}

  .grid__item.four-tenths>
    .white-box.islet
      %h1.flush.blue.beta
        = @course.name
      %h2.weight-normal.delta
        = link_to structure_path(@structure), onclick: "_gaq.push(['_trackEvent', 'Voir l établissement', 'click','#{@course.slug}'])" do
          %i.icon-map-marker.v-middle
          %span.v-middle= @structure.name

      = render 'contact_structure'

    .text--center.white-box.soft-half.push--top.push--bottom
      - if @structure.rating
        %a#show-comments.muted-link.thin.big-alpha.brand{href: 'javascript:void(0)'} #{@structure.comments_count}
        %div
          avis
          %a{href: '#comments'}
            %i.lbc-brand-icon
        .delta{itemprop: 'aggregateRating', itemscope: true, itemtype: 'http://data-vocabulary.org/review-aggregate'}
          %span.rating{title: comment_rating_title(@structure.rating)}
            = rating_stars @structure.rating
          %meta{property: 'v:rating', itemprop: 'rating', content: @structure.rating}
          %meta{itemprop: 'count', content: @structure.comments.count}
          %meta{itemprop: 'itemreviewed', content: @structure.name}
          %meta{itemprop: 'name', content: @structure.name}
          %meta{itemprop: 'street-address', content: @structure.street}
          %meta{itemprop: 'postal-code', content: @structure.zip_code}
          %meta{itemprop: 'locality', content: @structure.city.name}
      - else
        Cet établissement n'a pas encore d'avis
      .text--center= link_to 'Donner mon avis', new_structure_comment_path(@structure)

    - if @course.image.present?
      .white-box.islet
        .push-half--top= image_tag @course.image.url(:normal), class: 'course-header-badge-image', alt: "#{@course.type_name} de #{join_course_subjects_text(@course)} : #{@course.name}", longdesc: @course.description
    .push--top.push--bottom
      = link_to 'Partager ce cours sur Facebook', "https://www.facebook.com/sharer/sharer.php?u=#{structure_course_path(@structure, @course)}", class: 'btn--facebook btn one-whole', target: '_blank', onclick: "_gaq.push(['_trackEvent', 'Share on Facebook', 'click', 'From place page'])"



= content_for :scripts do
  :javascript
    $(function() {
        var places_are_hidden = true;
        $('#show-comments').click(function(){
          $.scrollTo($('[href="#tab-comments"]'), {duration: 200});
          $('[href="#tab-comments"]').click();
        });
        $('#show-all-places').click(function() {
            if (places_are_hidden) {
                $(this).text('Cacher les adresses');
                $('#place-list .hidden').removeClass('hidden');
            } else {
                $('#place-list li').addClass('hidden');
                $(this).text('Voir les adresses');
            }
            places_are_hidden = !places_are_hidden;
        });
        $('[href=#tab-medias]').click(function(){
            setTimeout(function(){
              $('.media-gallery').masonry({ itemSelector: '.media__item' });
            }, 5);
        });
        $('.media-gallery .media__item a').fancybox({ helpers : { media : {} } });
    });

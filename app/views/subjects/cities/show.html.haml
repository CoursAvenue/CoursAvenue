= content_for :title do
  Tous les cours de #{@subject.name.downcase} à #{@city.name} | CoursAvenue

= content_for :description do
  Tous les cours de #{@subject.name.downcase} à #{@city.name} | CoursAvenue

= content_for :above_container do
  - if @city.image.present?
    .home-screen.bg-cover{style: "background-image: url('#{@city.image.url(:default)}')"}
      - if @subject.image.present?
        .soft--top
          = image_tag @subject.image.url(:thumb), class: 'block center-block subject-logo white-circle white-circle--thick', height: 130
      .main-container.main-container--medium
        %h1.white.soft-black-text-shadow{style: (@subject.image.present? ? '' : 'padding-top: 3em;')}
          Tous les cours de <strong>#{@subject.name.downcase}</strong> à <strong>#{@city.name}</strong>
        - if @subject.title.present?
          %h4.push--top.white.soft-black-text-shadow
            = @subject.title
        - elsif @city.title.present?
          %h4.push--tops.white.soft-black-text-shadow
            = @city.title
  - else
    #map.google-map.google-map--medium-small

  .white-box
    .main-container.push--ends
      .grid
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Profils
          .f-weight-bold= @structures_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Séances
          .f-weight-bold= @plannings_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Lieux
          .f-weight-bold= @places_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Cours d'essai gratuit
          .f-weight-bold= @free_trial_course_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Photos & vidéos
          .f-weight-bold= @medias_count
        .grid__item.one-sixth.text--center.delta>
          %div.soft-half--bottom Avis d'élèves
          .f-weight-bold= @comments_count


= render partial: 'subjects/description'

- if @subject.depth > 0 and @videos and @videos.any?
  %h3.text--center Sélection des vidéos de cours de <strong>#{@subject.name.downcase}</strong> à <strong>#{@city.name}</strong>
  .media-gallery.white-box>
    = render partial: 'medias/media', collection: @videos, locals: { width_class_name: 'one-fifth v-top text--center', vertical: true}
%hr

= render partial: 'subjects/subjects_facets'

.text--center.push--bottom
  = link_to structures_path(lat: @city.latitude, lng: @city.longitude, name: @subject.name), class: 'btn btn--green btn--large' do
    Voir tous les cours de
    %strong= @subject.name
    à
    %strong= @city.name

- unless @city.image.present?
  = content_for :scripts do
    :javascript
      $(function() {
          handler = Gmaps.build('Google', { markers: { maxRandomDistance: null } });
          handler.buildMap({ provider: { scrollwheel: false }, internal: {id: 'map'}}, function(){
              markers = handler.addMarkers(#{@city_latlng.to_json});
              handler.bounds.extendWith(markers);
              handler.fitMapToBounds();
          });
          google.maps.event.addListener(handler.getMap(), 'tilesloaded', function() {
              handler.getMap().setZoom(12);
          });
      });

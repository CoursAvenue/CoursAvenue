= user_menu_currently_at 'Mon tableau de bord'

.white-box.push--bottom
  .grid
    .grid__item.one-half.bordered--right>
      .islet
        %h4.push-half--bottom
          Votre profil est complété à #{@profile_completion}%
        .text--center.progress.push-half--bottom{style: "width: 280px;"}
          - if @profile_completion == 0
            #{@profile_completion}%
          - else
            #profile-progress-bar.bar.bar-success{style: "width: 0%;"}
              #{@profile_completion}%
        %ul.no-bullet-list
          %li
            %i.fa.fa-check-square-o
            %span.line-through Créer mon profil
          %li
            - if current_user.has_avatar?
              %i.fa.fa-check-square-o
              %span.line-through Ajouter ma photo
            - else
              = link_to edit_user_path(current_user), class: 'profile-task-uncomplete' do
                %i.fa.fa-square-o
                Ajouter ma photo
          %li
            - if current_user.city
              %i.fa.fa-check-square-o
              %span.line-through Renseigner ma ville
            - else
              = link_to edit_user_path(current_user), class: 'profile-task-uncomplete' do
                %i.fa.fa-square-o
                Renseigner ma ville
          %li
            - if current_user.gender and current_user.birthdate
              %i.fa.fa-check-square-o
              %span.line-through Compléter mes informations générales
            - else
              = link_to edit_user_path(current_user), class: 'profile-task-uncomplete' do
                %i.fa.fa-square-o
                Compléter mes informations générales
          %li
            - if current_user.passions.any?
              %i.fa.fa-check-square-o
              %span.line-through Renseigner mes passions
            - else
              = link_to user_passions_path(current_user), class: 'profile-task-uncomplete' do
                %i.fa.fa-square-o
                Renseigner mes passions


%hr

%h4 Mes infos

.white-box.flexbox
  .flexbox__item.v-top.one-sixth>
    - if @user.has_avatar?
      = image_tag @user.avatar_url(:thumb), class: 'block'
    - else
      .text--center.push-half--top= link_to 'Ajouter ma photo', edit_user_path(current_user)
  .flexbox__item.v-top.soft-half>
    %h4.flush= @user.name
    %p.flush
      = t(@user.gender)
      - if @user.birthdate
        %br
        %strong Né le #{l(@user.birthdate)}
    = link_to 'Modifier mes infos', edit_user_path(current_user)

%hr.push--top
%h4 Mes derniers messages
- @conversations.each do |conversation|
  = link_to user_conversation_path(current_user, conversation), class: 'muted-link' do
    = render partial: 'conversations/conversation', locals: {conversation: conversation}
- if @conversations.empty?
  %p.white-box.soft-half
    Vous n'avez pas envoyer de message.
- if current_user.structures.any?
  .text--center.push--bottom
    = link_to 'Envoyer un nouveau message', new_user_message_path(current_user), class: 'btn btn--blue'


= content_for :scripts do
  :javascript
    $(function() {
        $('#profile-progress-bar').animate({
            width: '#{@profile_completion}%'
        }, 800)
    });

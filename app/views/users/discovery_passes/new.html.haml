= user_menu_currently_at 'discovery_pass'

.panel
  .panel__header.soft
    = render partial: 'users/discovery_passes/breadcrumb', locals: { current: 'recap' }
  .panel__body.soft
    .grid
      .grid__item.two-thirds>
        .panel{ style: 'height: 300px; '}
          .panel__header.soft-half
            %h4.flush Achat du Pass
          .panel__body.soft-half
            %table.epsilon.table--striped
              %thead
                %tr
                  %th.one-half Offre
                  %th.one-half Montant
              %tbody
                %tr
                  %td Pass Découverte
                  %td
                    19€
                - if @discovery_pass.sponsorship
                  %tr
                    %td Offre parrainage
                    %td= "-#{number_to_currency(@discovery_pass.sponsorship.credit_for_sponsored_user).gsub(/\,00/, "")} (valable pour le 1er mois)"
                %tr.text--right
                  %th Total TTC
                  %td= number_to_currency(@discovery_pass.amount).gsub(/\,00/, "")

                - if !@discovery_pass.sponsorship
                  %tr.no-stripe
                    %td
                    %td
                      = form_for @user, method: :get, url: new_user_discovery_pass_path(@user) do
                        .hidden.promo-hidden
                          %input#promo-code{ name: 'promo_code', placeholder: 'CODE'}
                          %input.btn.btn--green{ type: 'submit', value: 'OK' }
                        %a.pointer.milli#i-have-promo-code Entrer un code promotionnel
            .push--top
              %br
              %br
              = form_tag ENV['BE2BILL_URL'] do
                - @be2bill_params.each do |key, value|
                  = hidden_field_tag key.to_sym, value
                = submit_tag 'Payer', class: 'btn btn--green btn--large btn--full hard--sides', data: { disable_with: 'Veuillez patienter...' }
      .grid__item.one-third>
        .panel{ style: 'height: 300px; '}
          .panel__header.soft-half
            %h4.flush Résumé de votre Achat
          .panel__body.soft-half
            %p
              Chaque mois, participez à autant de séances d'essai que vous le souhaitez parmi les #{Planning.available_in_discovery_pass.count.round(-2)} cours de loisirs négociés spécialement pour vous auprès de nos #{Structure.available_in_discovery_pass.count.round(-2)} partenaires parisiens. Vous pouvez renouveller votre Pass autant de fois que vous le souhaitez.

              %ul.no-bullet-list
                %li.flexbox
                  .flexbox__item.soft-half--right.v-middle
                    %i.fa.fa-check.green.delta
                  .flexbox__item.v-middle.one-whole
                    Pass nominatif <strong>valable 30 jours</strong>, renouvelable
                %li.flexbox
                  .flexbox__item.soft-half--right.v-middle
                    %i.fa.fa-check.green.delta
                  .flexbox__item.v-middle.one-whole
                    %strong 1 300 cours
                    à découvrir à Paris et sa région
                    Paris et sa région
                %li.flexbox
                  .flexbox__item.soft-half--right.v-middle
                    %i.fa.fa-check.green.delta
                  .flexbox__item.v-middle.one-whole
                    %strong Jusqu'à 3 séances
                    offertes chez chaque partenaire
              %hr
              .grid.epsilon
                .grid__item.one-half>
                  %strong TOTAL
                .grid__item.one-half.text--right>
                  %strong= "#{number_to_currency(@discovery_pass.amount).gsub(/\,00/, "")}"


= content_for :scripts do
  :javascript
    $(function() {
      ga('send', 'event', 'PassDecouverte', 'Step 1 : Achat du Pass');
      $('#i-have-promo-code').click(function(){
          $(this).hide();
          $('.promo-hidden').show();
      });
    })

- if @user.zip_code.present? and !@user.zip_code.starts_with?('75')
  .panel.hidden#not-in-paris
    .panel__header.soft
      %h4.flush Êtes-vous à Paris ?
    .panel__body.soft.epsilon
      %strong Attention !
      Actuellement, le Pass concerne exclusivement Paris et ses alentours. Or, selon votre code postal, vous vous situez dans une autre région. Si vous souhaitez un Pass en dehors de cette zone,
      = link_to 'contactez-nous.', pages_contact_url(subdomain: CoursAvenue::Application::WWW_SUBDOMAIN)
  = content_for :scripts do
    :javascript
      $(function() {
          $.fancybox.open($('#not-in-paris'), { width: 400, maxWidth: 400, padding: 0});
      });

= render 'shared/live_chat'


- if Rails.env.production?
  = content_for :scripts do
    :javascript
      $(function() {
          mixpanel.track("Landed on 'Achat du Pass'");
          mixpanel.people.set({
              'pass_step_2': true
          });
      });

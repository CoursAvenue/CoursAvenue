- calendar = true if calendar.nil?
%tr
  %td.nowrap{ class: [participation_request_color(participation_request), ((participation_request.accepted? or participation_request.canceled?) ? 'nowrap' : '')] }
    - if participation_request.pending?
      - if participation_request.last_modified_by == 'Structure'
        %span.has-tooltip{ data: { toggle: 'popover', content: 'Confirmez votre inscription', html: 'true', placement: 'top', trigger: 'hover' } } En attente
      - else
        %span.has-tooltip{ data: { toggle: 'popover', content: 'En attente de validation du professeur', html: 'true', placement: 'top', trigger: 'hover' } } En attente
    - else
      = t("participation_request.state.#{participation_request.state}")
  %td.three-twelfths
    - course = participation_request.course
    %span.has-tooltip{ data: { toggle: 'popover', content: "<strong>Niveau :</strong> #{join_levels(participation_request.levels)}<br><strong>Public :</strong> #{join_audiences(participation_request.planning || participation_request.course)}<br><strong>Disciplines :</strong> #{course.subjects.uniq.map(&:name).join(', ')}", html: 'true', placement: 'top', trigger: 'hover' } }
      = course.name
    avec
    = link_to participation_request.structure.name, structure_path(participation_request.structure), target: :_blank
  %td
    - place = participation_request.place
    - if place
      - if place.info.present? or place.private_info.present?
        %span.has-tooltip{ data: { toggle: 'popover', content: t('places.infos', info: place.info, private_info: place.private_info), html: 'true', placement: 'top', trigger: 'hover' } }
          %i.fa.fa-map-marker
          = place.address
      - else
        %i.fa.fa-map-marker
        = place.address
    %br
  %td.two-twelfths
    = "#{l(participation_request.date, format: :semi_short)} à #{l(participation_request.start_time, format: :short)}"
  %td.two-twelfths.nowrap
    = link_to 'Récapitulatif', user_participation_request_path(@user, participation_request)
    .drop-down-el.drop-down__wrapper{ data: { behavior: 'drop-down', el: '> .drop-down__el', position: 'right' } }
      %a.nowrap{ href: '#' }
        Actions
        %i.fa.fa-chevron-down
      %ul.drop-down__el.text--left
        - if !participation_request.canceled? and !participation_request.declined?
          %li.nowrap
            - if participation_request.pending? and participation_request.last_modified_by == 'Structure'
              = link_to "Accepter le nouveau créneau", accept_user_participation_request_path(@user, participation_request), method: :patch, class: 'green nowrap'
          %li.nowrap
            = link_to 'Proposer un autre créneau', edit_user_participation_request_path(@user, participation_request, return_to: user_participation_requests_path(@user)), class: 'orange nowrap fancybox.ajax', data: { behavior: 'modal', width: 800, padding: 0 }
        - if !participation_request.canceled? and !participation_request.declined?
          %li.nowrap
          = link_to "Annuler l'inscription", cancel_form_user_participation_request_path(@user, participation_request, return_to: user_participation_requests_path(@user)), class: 'red nowrap fancybox.ajax', data: { behavior: 'modal', width: 800, padding: 0 }
  - if calendar
    %td.nowrap.one-twelfth
      = add_to_calendar_small(participation_request)

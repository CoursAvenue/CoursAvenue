- if @subject
  - title = "#{@subject.name}"
- else
  - title = "Danse, Théâtre, Musique, Yoga..."

= content_for :title do
  - if @city
    = @vertical_page_decorator.page_title(@city)
  - else
    = @vertical_page_decorator.page_title

= content_for :meta_description do
  - if @city
    = "#{@vertical_page_decorator.page_h1} à #{@city.name} (#{@city.department_code}) : toutes les écoles de #{@vertical_page.subject_name.downcase} à #{@city.name}, stages, cours d'essai gratuits, plannings, tarifs, conseils, avis, promotions"
  - else
    = "#{@vertical_page_decorator.page_h1} : toutes les cours de #{@vertical_page.subject_name.downcase}, stages, cours d'essai gratuits, plannings, tarifs, conseils, avis, promotions"

- @paris = City.find('paris')
.relative.search-page-filters__panel-height.palm-height-auto
  .soft--ends.absolute.north.west.on-top-of-the-world.home-page-curtain.one-whole.flexbox.search-page-filters__panel-height.palm-static.palm-height-auto
    .flexbox__item.v-middle
      .main-container.main-container--medium.white.text--center
        %h1.f-size-really-big= @vertical_page_decorator.page_h1(@city)
        - if @vertical_page.caption
          %h4.center-block
            = @vertical_page.caption
        .soft--top
          - if @subject.root?
            = link_to root_search_page_path(@subject.root, (@city || 'paris'), locate_user: (@city ? '' : 'on')), class: 'btn btn--blue-green btn--large see-all-courses-tracker'do
              %i.fa.fa-map-marker
              Voir les cours #{@city ? "à #{@city.name}" : 'autour de moi'}
          - else
            = link_to search_page_path(@subject.root, @subject, (@city || 'paris'), locate_user: (@city ? '' : 'on')), class: 'btn btn--blue-green btn--large see-all-courses-tracker'do
              %i.fa.fa-map-marker
              Voir les cours #{@city ? "à #{@city.name}" : 'autour de moi'}
  = react_component('MapContainer', { center: [(@city || @paris).latitude, (@city || @paris).longitude] })
.main-container.main-container--medium.soft--ends
  .soft-half--left= render partial: 'vertical_pages/breadcrumb'
  .grid
    .grid__item.six-tenths.palm-one-whole>
      = react_component('ResultList', { root_subject: (@root_subject ? @root_subject : nil),
                                        subject: (@subject and @subject != @root_subject ? @subject : nil),
                                        address: { name: (@city || @paris).name, latitude: (@city || @paris).latitude, longitude: (@city || @paris).longitude, city: (@city || @paris).name, is_address: false },
                                        per_line: 2,
                                        per_page: 14,
                                        follow_links: true })
    .grid__item.four-tenths.palm-one-whole.palm-push--top>
      - if @vertical_page.content.present?
        %h2
          = @vertical_page.title
        .epsilon.line-height-1-5
          = @vertical_page.content.html_safe
      - else
        - if @subject.good_to_know.present?
          %h3 Bon à savoir / Qu'est-ce que c'est ?
          %p= @subject.good_to_know
        - if @subject.needed_meterial.present?
          %h3 Les bienfaits
          %p= @subject.needed_meterial
        - if @subject.tips.present?
          %h3 Matériel à prévoir
          %p= @subject.tips
      - if @subject.depth == 2
        = render partial: 'vertical_pages/siblings'
      - unless @city
        %h3= "Les lieux les plus recherchés"
        .push--bottom
          - @cities.each do |city|
            - next if StructureSearch.search(lat: city.latitude, lng: city.longitude).total < 10
            %div
              - if @subject.is_root?
                = link_to "Cours de #{@vertical_page.subject_name.downcase} à #{city.name}", root_vertical_page_with_city_path(@vertical_page, city), class: 'epsilon line-height-1-7'
              - else
                = link_to "Cours de #{@vertical_page.subject_name.downcase} à #{city.name}", vertical_page_with_city_path(@subject.root, @vertical_page, city), class: 'epsilon line-height-1-7'

  .text--center
    - if @subject.root?
      = link_to root_search_page_path(@subject.root, (@city || 'paris'), locate_user: (@city ? '' : 'on')), class: 'btn btn--blue-green btn--large see-all-courses-tracker' do
        %i.fa.fa-map-marker
        Voir tous les cours #{@city ? "à #{@city.name} (#{@city.zip_code})" : 'autour de moi'}
    - else
      = link_to search_page_path(@subject.root, @subject, (@city || 'paris'), locate_user: (@city ? '' : 'on')), class: 'btn btn--blue-green btn--large see-all-courses-tracker' do
        %i.fa.fa-map-marker
        Voir tous les cours #{@city ? "à #{@city.name} (#{@city.zip_code})" : 'autour de moi'}
= content_for :scripts do
  :javascript
    window.is_mobile = COURSAVENUE.helperMethods.isMobile.any();


- if @subject.depth == 0
  .home-screen-promotion-wrapper
    .main-container.main-container--medium.soft--ends
      %h2.soft--bottom.f-weight-300 #{@subject.name} : plus de disciplines
      - cache [@subject, 'vertical_pages/subjects/depth_1'] do
        = render partial: 'vertical_pages/subjects', locals: { subjects: @subject.children.includes(:vertical_pages) }

- unless @subject.depth == 2
  .soft--ends{ class: (@subject.depth == 0 ? '' : 'home-screen-promotion-wrapper') }
    .main-container.main-container--medium
      %h2.soft--bottom.f-weight-300 #{@subject.name} : tous les styles
      - cache [@subject, 'vertical_pages/subjects/depth_2'] do
        = render partial: 'vertical_pages/subjects', locals: { subjects: @subject.descendants.at_depth(2).includes(:vertical_pages) }

- if @vertical_page.reviews.any?
  %div{ class: (@subject.depth == 0 || @subject.depth == 2 ? 'home-screen-promotion-wrapper' : '') }
    .main-container.main-container--medium.soft--ends
      %h2.soft--bottom.f-weight-300 #{@vertical_page.title} : sélection d'avis
      = render partial: 'vertical_pages/comments', locals: { comments: @vertical_page.reviews }

- if @vertical_page.blog_articles.any?
  %div{ class: (@subject.depth == 0 || @subject.depth == 2 ? '' : 'home-screen-promotion-wrapper') }
    .main-container.main-container--medium.soft--ends
      %h2.soft--bottom.f-weight-300 Articles de blog associés
      = render partial: 'vertical_pages/blog_articles', locals: { articles: @vertical_page.blog_articles }

= content_for :scripts do
  :javascript
      $(function() {
          mixpanel.track('VerticalPage landing');
          mixpanel.track_links('.see-all-courses-tracker', 'VerticalPage - Clicked on see all courses');
          mixpanel.track_links('.search-page-card__subject', 'VerticalPage - Clicked on subject');
          mixpanel.track_links('.search-page-card__course-title', 'VerticalPage - Clicked on course title');
          mixpanel.track_links('.search-page-card__structure-name', 'VerticalPage - Clicked on structure');
      });

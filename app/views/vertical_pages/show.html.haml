= content_for :title do
  - if @vertical_page.name.present?
    = @vertical_page.name
  - else
    Tous les cours de #{@subject.name.downcase} | CoursAvenue

= content_for :meta_description do
  - if @vertical_page.title.present?
    = @vertical_page.caption
  - else
    Tous les cours de #{@subject.name.downcase} | CoursAvenue

- slug = @subject.root.slug
- if @vertical_page.image.present?
  - bg = asset_path(@vertical_page.image.url(:large))
- else
  - bg = asset_path(subject_image(@subject))

.bg-cover{ style: "background-image: url('#{bg}')", 'data-stellar-background-ratio' => '0.6' }
  .main-container.main-container--medium.soft--ends
    %h1.white.soft-black-text-shadow= @vertical_page.name
    - if @vertical_page.caption
      %h4.center-block.white.soft-black-text-shadow
        = @vertical_page.caption

.main-container.main-container--medium.soft--ends
  %ul.breadcrumb
    - @ancestors.each do |ancestor|
      %li
        = link_to ancestor.name, vertical_page_path(ancestor.vertical_pages.first)

  .float--right.two-fifths.palm-one-whole.v-top.push--left.push--bottom>
    = render partial: 'vertical_pages/cities'
  .blog-article__content
    - if @vertical_page.content.present?
      %h2
        = @vertical_page.title
      = @vertical_page.content.html_safe
    - else
      - if @subject.good_to_know.present?
        %h3 Bon à savoir / Qu'est-ce que c'est ?
        %p= @subject.good_to_know
      - if @subject.needed_meterial.present?
        %h3 Les bienfaits
        %p= @subject.needed_meterial
      - if @subject.tips.present?
        %h3 Matériel à prévoir
        %p= @subject.tips
  - if @vertical_page.medias.any?
    = render partial: 'structures/map_and_gallery', locals: { medias: @vertical_page.medias, without_map: true }

- if @subject.depth == 0
  .home-screen-promotion-wrapper
    .main-container.main-container--medium.soft--ends
      %h2.soft--bottom.f-weight-300 Plus de disciplines
      = render partial: 'vertical_pages/subjects', locals: { subjects: @subject.children }

- unless @subject.depth == 2
  .soft--ends{ class: (@subject.depth == 0 ? '' : 'home-screen-promotion-wrapper') }
    .main-container.main-container--medium
      %h2.soft--bottom.f-weight-300 Tous les styles
      = render partial: 'vertical_pages/subjects', locals: { subjects: @subject.descendants.at_depth(2) }

%div{ class: (@subject.depth == 0 || @subject.depth == 2 ? 'home-screen-promotion-wrapper' : '') }
  .main-container.main-container--medium.soft--ends
    %h2.soft--bottom.f-weight-300 Sélection d'avis
    - CommentSearch.search(per_page: 4, has_avatar: true, has_title: true, subject_slugs: [@subject.root.slug, @subject.slug]).results.in_groups_of(2, false).each do |review_group|
      .grid.push--bottom
        - review_group.each do |review|
          .grid__item.one-half.palm-one-whole.lap-one-half>
            .flexbox.push--bottom
              .flexbox__item.soft--left.v-top.text--center>
                = link_to structure_url(review.structure, subdomain: CoursAvenue::Application::WWW_SUBDOMAIN), class: 'block media-photo', target: :_blank, class: 'muted-link' do
                  = image_tag review.user.avatar_url(:thumb), class: 'block rounded--circle', width: 60
                .milli.soft-half--top
                  = review.author_name
              .flexbox__item.soft--sides.v-top>
                .message__body.soft-half.message__appendix.gray-box
                  %p.epsilon.push-half--bottom.quoted
                    %strong= review.title
                  %p
                    = truncate(review.content, length: 500)
                  %p.text--right.flush
                    %i
                      À propos de
                      = link_to review.structure.name, structure_url(review.structure, subdomain: CoursAvenue::Application::WWW_SUBDOMAIN), target: :_blank

- if @vertical_page.keywords
  .main-container.main-container--medium.soft--ends.text--center
    - @vertical_page.keywords.split(',').each do |keyword|
      - @cities.each do |city|
        %span.push-half--right= link_to "#{keyword} à #{city.name}", structures_path_for_city_and_subject(city, @subject)

- if %w(danse theatre-scene musique-chant).include?(@subject.root.slug)
  - subject = 'Danse, Théâtre & Musique'
  - image_url = "https://dqggv9zcmarb3.cloudfront.net/assets/search-page-app/group-subject-theatre.jpg"
- if %w(sports-arts-martiaux yoga-bien-etre-sante cuisine-vins).include?(@subject.root.slug)
  - subject = 'Sports, Yoga & Bien-être'
  - image_url = "https://dqggv9zcmarb3.cloudfront.net/assets/search-page-app/group-subject-yoga.jpg"
- if %w(deco-mode-bricolage dessin-peinture-arts-plastiques photo-video).include?(@subject.root.slug)
  - subject = 'Arts créatifs'
  - image_url = "https://dqggv9zcmarb3.cloudfront.net/assets/search-page-app/group-subject-arts.jpg"

- cookies[:test] = '100_dolls_pass'
- @paris = City.find('paris')
- @city ||= @paris
- if @city.name.include?('Paris')
  - @city = @paris

- @structure = Structure.find(params[:structure]) if params[:structure].present?
- if @structure
  = render partial: 'structures/popup_from_structure'

.relative.search-page-filters__panel-height.palm-height-auto
  .soft--ends.absolute.north.west.home-page-curtain.one-whole.flexbox.search-page-filters__panel-height.palm-static.palm-height-auto.z-index-10000
    .flexbox__item.v-middle
      = image_tag image_url, class: 'center-block rounded--circle', width: 125, height: 125
      %h1.soft--sides.white.text--center.f-size-really-big.line-height-1-3
        Le coup de pouce qui va vous motiver à vous lancer
      .white.text--center
        %h4.center-block
          Le Pass #{subject} vous permet d'essayer les meilleures activités de loisirs près de chez vous, puis de bénéficier
          %br
          d'une réduction sur votre 1er abonnement si un cours vous plaît. Si aucune séance ne vous convient, nous vous
          %br
          remboursons. Ainsi, vous ne prenez aucun risque et votre satisfaction est garantie.


      .text--center
        = link_to checkout_step_1_collection_structures_path, class: 'btn btn--yellow btn--large push-half--right' do
          Obtenir mon pass #{subject}
        = link_to checkout_step_1_collection_structures_path(gift: true), class: 'btn btn--white btn--white-transparent btn--white-transparent--white btn--large' do
          Offrir le pass

  - map_zoom = 12 if @city and @city.size == 3
  - map_zoom = 14 if @city and @city.size != 3
  - map_zoom = 15 if @neighborhood
  = react_component('MapContainer', { zoom: map_zoom, center: [(@neighborhood || @city || @paris).latitude, (@neighborhood || @city || @paris).longitude] })


.flexbox
  .bg-danse.btn--danse.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-theatre-scene.btn--theatre-scene.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-musique-chant.btn--musique-chant.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-cuisine-vins.btn--cuisine-vins.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-yoga-bien-etre-sante.btn--yoga-bien-etre-sante.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-sports-arts-martiaux.btn--sports-arts-martiaux.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-photo-video.btn--photo-video.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-deco-mode-bricolage.btn--deco-mode-bricolage.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>
  .bg-dessin-peinture-arts-plastiques.btn--dessin-peinture-arts-plastiques.text--center.white.flexbox__item.one-ninth.palm-one-third.very-soft>


.text--center.bg-white.soft
  %strong.epsilon Pass à 70€ d'une valeur de 100€
  %strong.epsilon.soft--sides.blue-green •
  %strong.epsilon Déduit de votre 1er abonnement ou remboursé
  %strong.epsilon.soft--sides.blue-green •
  %strong.epsilon Valable à vie
.main-container.soft--ends

  .grid.push--bottom
    .grid__item.one-third.text--center>
      .soft--ends
        = image_tag 'https://coursavenue-public.s3.amazonaws.com/test/test2-logo3.png', height: 100
      %h4.gamma Obtenez votre Pass

      %p
        Si un cours vous plaît, les 99€ de votre Pass seront déduits de votre 1er abonnement (par exemple, vous ne paierez que 151€ pour un trimestre à 250€).
        %br
        Sinon, nous vous remboursons.
    .grid__item.one-third.text--center>
      .soft--ends
        = image_tag 'https://coursavenue-public.s3.amazonaws.com/test/test2-logo2.png', height: 100
      %h4.gamma Essayez différentes séances

      %p Grâce aux 10 000 avis, inscrivez-vous directement en ligne en fonction de vos critères : lieu, créneau horaire, niveau, etc.
    .grid__item.one-third.text--center>
      .soft--ends
        = image_tag 'https://coursavenue-public.s3.amazonaws.com/test/test2-logo1.png', height: 100
      %h4.gamma Abonnez-vous sans frais
      %p
        Dès qu'un cours vous convient, fournissez le numéro de votre Pass au professeur qui déduira les 99€ de votre 1er abonnement : ainsi, votre Pass ne vous coûte rien !

  .text--center.push--bottom.soft--bottom
    = link_to "Obtenir mon Pass", checkout_step_1_collection_structures_path(city: @city.slug, subject: @subject.slug), class: 'btn btn--yellow btn--bigger'
    = link_to "Offrir le Pass", checkout_step_1_collection_structures_path(city: @city.slug, subject: @subject.slug, gift: true), class: 'btn btn--white btn--bigger push--left'


  - _comments = CommentSearch.search(subject_slug: @subject.slug, per_page: 50)
  - comments  = _comments.group_by(&:structure).map(&:last).map(&:first)
  - if comments.length == 2
    - comments << (_comments - comments).sample
  - elsif comments.length == 1
    - comments << (_comments - comments).sample
    - comments << (_comments - comments).sample
  - elsif comments.length == 0
    - comments = _comments
  - if comments.length == 0
    - comments = Comment.last(3)

  .grid.push--bottom
    .grid__item.one-third>
      .flexbox.green-box.text--center.white{ style: 'height: 20em;' }>
        .flexbox__item.soft--sides
          %i.fa.fa-3x.fa-comment.push--bottom
          .alpha 10 000 avis
          .gamma de la communauté
    .grid__item.one-third>
      .flexbox.v-top.white-box{ style: 'height: 20em;' }>
        .flexbox__item.v-top
          - image_url = (comments[0] || Comment.offset(3).last(1).first).structure.logo.url(:thumbnail_email_cropped)
          = link_to '', structure_path((comments[0] || Comment.offset(3).last(1).first).structure), class: 'bg-cover block', target: :_blank, style: "background-image: url('#{image_url}'); height: 10em;"
          .soft
            .line-height-1-3.quoted= truncate((comments[0] || Comment.offset(3).last(1).first).content, length: 150)
            .float--right
              %strong= "Par #{(comments[0] || Comment.offset(3).last(1).first).author_name}"
    .grid__item.one-third>
      .flexbox.yellow-box.text--center.white{ style: 'height: 20em;' }>
        .flexbox__item.soft--sides
          %i.fa.fa-3x.fa-list.push--bottom
          .alpha #{@subject.indexable_cards.count * 3}
          .gamma séances vous sont ouvertes
  .grid
    .grid__item.one-third>
      .flexbox.v-top.white-box{ style: 'height: 20em;' }>
        .flexbox__item.v-top
          - image_url = (comments[1] || Comment.offset(1).last(1).first).structure.logo.url(:thumbnail_email_cropped)
          = link_to '', structure_path((comments[1] || Comment.offset(1).last(1).first).structure), class: 'bg-cover block', target: :_blank, style: "background-image: url('#{image_url}'); height: 10em;"
          .soft
            .line-height-1-3.quoted= truncate((comments[1] || Comment.offset(1).last(1).first).content, length: 150)
            .float--right
              %strong= "Par #{(comments[1] || Comment.offset(1).last(1).first).author_name}"
    .grid__item.one-third.white>
      .flexbox.dark-blue-box.text--center.white{ style: 'height: 20em;' }>
        .flexbox__item
          %i.fa.fa-3x.fa-face-happy.push--bottom
          .alpha 98%
          .gamma de nos utilisateurs sont satisfaits
    .grid__item.one-third>
      .flexbox.v-top.white-box{ style: 'height: 20em;' }>
        .flexbox__item.v-top
          - image_url = (comments[2] || Comment.offset(2).last(1).first).structure.logo.url(:thumbnail_email_cropped)
          = link_to '', structure_path((comments[2] || Comment.offset(2).last(1).first).structure), class: 'bg-cover block', target: :_blank, style: "background-image: url('#{image_url}'); height: 10em;"
          .soft
            .line-height-1-3.quoted= truncate((comments[2] || Comment.offset(2).last(1).first).content, length: 150)
            .float--right
              %strong= "Par #{(comments[2] || Comment.offset(2).last(1).first).author_name}"

- if @descendants
  .soft--top
    - @descendants.each_with_index do |vertical_page, index|
      %h5.inline-block.flush.gamma.muted-link.v-middle.search-page-filters__image-button.palm-one-whole.palm-block.bg-cover{ class: ((index % 5 < 3) ? 'one-third' : 'one-half'), style: "background-image: url('#{vertical_page.image.url(:homepage_small)}');" }>
        .search-page-filters__image-button-curtain
        .flexbox.relative.search-page-filters__panel-half-height
          .flexbox__item.v-middle
            = link_to "Cours de #{vertical_page.subject_name.downcase}", vertical_page_path(vertical_page.root_subject, vertical_page), class: 'white semi-muted-link block'

- @indexable_card = @subject.indexable_cards.sample
- @card_redux = { id: @indexable_card.id, slug: @indexable_card.slug, subjects: @indexable_card.subjects.pluck(:slug), position: { lat: @city.latitude, lng: @city.longitude } }

.soft-double.soft--bottom.palm-hard#card-suggestions
  .grid--full.push--bottom
    %h2.text--center Des centaines de séances ouvertes toute l'année
    - root_subject = @subject.root
    .main-container.main-container--1000
      = react_component('ResultList', { root_subject: (root_subject ? root_subject : nil),
                                        hide_help_card: true,
                                        subject: (@subject and @subject != root_subject ? @subject : nil),
                                        address: { name: (@neighborhood || @city || @paris).name, latitude: (@neighborhood || @city || @paris).latitude, longitude: (@neighborhood || @city || @paris).longitude, city: (@neighborhood || @city || @paris).name, is_address: false , is_neighborhood: @neighborhood.present? },
                                        per_line: 4,
                                        per_page: 8,
                                        follow_links: true })
    .text--center
      = @vertical_page_decorator.button(@subject, @city, @neighborhood, true)

= content_for :scripts do
  :javascript
      $(function() {
          mixpanel.track("PASS | Landing Pass", { subject: "#{@subject.try(:name)}" });
      });

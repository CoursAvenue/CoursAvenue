machine:
  timezone:
    Europe/Paris
  ruby:
    version: 2.1.5

deployment:
  staging:
    branch: *
    commands:
      - git push git@heroku.com:coursavenue-staging $CIRCLE_SHA1:master -f
      - heroku run rake db:migrate --app coursavenue-staging

database:
  post:
    - cp -R /opt/solr-4.3.1 $HOME/solr
    - cp config/schema.ci.xml $HOME/solr/example/solr/collection1/conf
    - cd $HOME/solr/example; java -jar start.jar $HOME/solr.log:
        background: true
  override:
    - cp config/database.ci.yml config/database.yml
    - cp config/mongoid.ci.yml config/mongoid.yml
    - bundle exec rake db:create db:schema:load
